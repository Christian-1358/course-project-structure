<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo Profissional</title>
    <style>
        body { background: #050505; color: #eee; font-family: sans-serif; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: #0c0c0c; padding: 25px; border-radius: 10px; border: 1px solid #222; }
        h2 { text-align: center; color: #a855f7; margin-bottom: 20px; }
        .nav-btns { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        th { background: #161b22; padding: 12px; font-size: 12px; color: #888; border-bottom: 2px solid #333; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #1a1a1a; font-size: 14px; }
        .btn { border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 10px; margin: 2px; }
        .btn-orange { background: #ff9f43; color: #000; }
        .btn-green { background: #238636; color: #fff; }
        .btn-red { background: #da3633; color: #fff; }
        .btn-blue { background: #0062ff; color: #fff; }
        .btn-gray { background: #444; color: #fff; }
        input { padding: 10px; background: #000; border: 1px solid #333; color: #fff; border-radius: 5px; width: 300px; }
    </style>
</head>
<body>
<div class="container">
    <h2>PAINEL DE CONTROLE MM</h2>
    
    <div class="nav-btns">
        <button class="btn btn-gray" onclick="window.location.href='/logout'">Sair</button>
        <button class="btn btn-blue" onclick="window.location.href='/curso'">Ir para o Curso</button>
        <button class="btn btn-green" onclick="verVendas()">Ver Vendas</button>
    </div>

    <div style="text-align: center; margin-bottom: 20px;">
        <input type="text" id="filtro" placeholder="Nome ou Email..." value="{{ mensagem.replace('Busca: ', '') if mensagem else '' }}">
        <button class="btn btn-blue" onclick="buscar()">Filtrar</button>
        <button class="btn btn-gray" onclick="window.location.href='/login_dev'">Limpar</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th><th>USU√ÅRIO / EMAIL</th><th>STATUS</th><th>A√á√ïES DE DESENVOLVEDOR</th>
            </tr>
        </thead>
        <tbody>
            {% for u in usuarios %}
            <tr>
                <td>{{ u['id'] }}</td>
                <td><b>{{ u['username'] }}</b><br><small>{{ u['email'] }}</small></td>
                <td>
                    <button class="btn {{ 'btn-green' if u['ativo'] == 1 else 'btn-red' }}" 
                            onclick="api('/admin/alterar_status', {id: '{{ u['id'] }}', ativo: {{ 0 if u['ativo'] == 1 else 1 }} })">
                        {{ 'Ativo' if u['ativo'] == 1 else 'Bloqueado' }}
                    </button>
                </td>
                <td>
                    <button class="btn btn-orange" onclick="api('/admin/forcar_notas', {id: '{{ u['id'] }}'})">üöÄ FULL 10</button>
                    <button class="btn btn-green" onclick="novaSenha('{{ u['id'] }}')">SENHA</button>
                    <button class="btn btn-orange" onclick="api('/admin/resetar_senha', {id: '{{ u['id'] }}'})">RESET</button>
                    <button class="btn btn-red" onclick="deletar('{{ u['id'] }}')">EXCLUIR</button>
                </td>
            </tr>
            {% end %}
        </tbody>
    </table>

    <h2 style="font-size: 18px;">üìä √öLTIMAS ATIVIDADES (NOTAS)</h2>
    <table>
        <thead><tr><th>ALUNO</th><th>M√ìDULO</th><th>NOTA</th><th>DATA/HORA</th></tr></thead>
        <tbody>
            {% for n in notas %}
            <tr><td>{{ n['username'] }}</td><td>M√≥dulo {{ n['modulo'] }}</td><td style="color:#3fb950">{{ n['nota'] }}</td><td>{{ n['data_hora'] }}</td></tr>
            {% end %}
        </tbody>
    </table>
</div>

<script>
    async function api(url, data) {
        const p = new URLSearchParams();
        for (const k in data) p.append(k, data[k]);
        const r = await fetch(url, { method: 'POST', body: p });
        const res = await r.json();
        alert(res.mensagem);
        location.reload();
    }
    function buscar() { window.location.href = '/admin/buscar_usuario?filtro=' + document.getElementById('filtro').value; }
    function novaSenha(id) { const s = prompt("Nova senha:"); if(s) api('/admin/alterar_senha', {id: id, senha: s}); }
    function deletar(id) { if(confirm("Excluir?")) api('/admin/deletar_usuario', {id: id}); }
    async function verVendas() {
        const r = await fetch('/admin/compras');
        const res = await r.json();
        alert("Total de vendas registradas: " + res.purchases.length);
        console.table(res.purchases);
    }
</script>
</body>
</html>