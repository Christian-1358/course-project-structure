<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mestre das Milhas | Plataforma de Certifica√ß√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0b0d; --panel: #161b22; --sidebar: #0d1117; --text: #e6edf3;
            --text-muted: #8b949e; --accent: #a855f7; --border: #30363d; --success: #238636;
            --danger: #f85149;
        }
        * { box-sizing: border-box; transition: all 0.2s ease; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        header { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 24px; background: var(--sidebar); border-bottom: 1px solid var(--border); z-index: 100; }
        .logo { font-weight: 800; font-size: 1.1rem; }
        .logo span { color: var(--accent); }
        
        .btn-test { background: rgba(248, 81, 73, 0.1); color: var(--danger); border: 1px solid var(--danger); font-size: 10px; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-right: 10px; font-weight: bold; text-transform: uppercase; }
        .btn-test:hover { background: var(--danger); color: white; }

        main { display: flex; flex: 1; overflow: hidden; position: relative; }
        .content-area { flex: 1; overflow-y: auto; background: var(--bg); }
        .video-container { width: 100%; background: #000; aspect-ratio: 16/9; position: relative; }
        .video-container iframe { width: 100%; height: 100%; border: none; }
        .toggle-sidebar-btn { position: absolute; right: 0; top: 50%; transform: translateY(-50%); background: var(--accent); color: white; border: none; padding: 15px 8px; cursor: pointer; border-radius: 8px 0 0 8px; z-index: 50; }
        
        .lesson-body { padding: 30px 40px; max-width: 1000px; }
        .nav-controls { display: flex; align-items: center; gap: 15px; margin: 25px 0; }
        
        .sidebar { width: 380px; background: var(--sidebar); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .sidebar.closed { width: 0; overflow: hidden; border-left: none; }
        .modules-wrapper { flex: 1; overflow-y: auto; }
        .module-item { border-bottom: 1px solid var(--border); }
        .module-btn { width: 100%; padding: 16px 20px; background: var(--panel); border: none; color: var(--text); display: flex; justify-content: space-between; cursor: pointer; font-size: 14px; font-weight: 600; text-align: left; }
        
        .lessons-list { display: none; }
        .module-item.open .lessons-list { display: block; }
        
        .lesson-item { padding: 15px 20px; display: flex; gap: 12px; cursor: pointer; font-size: 13px; border-bottom: 1px solid var(--border); align-items: center; }
        .lesson-item.active { background: #21262d; border-left: 4px solid var(--accent); }
        .lesson-item.completed span { color: var(--text-muted); text-decoration: line-through; }
        
        .lesson-item.is-quiz { background: rgba(168, 85, 247, 0.1); color: var(--accent); font-weight: 700; border-top: 1px solid var(--border); }

        .final-exam-area { padding: 20px; background: var(--panel); border-top: 2px solid var(--accent); }
        button { padding: 10px 18px; border-radius: 6px; cursor: pointer; border: 1px solid var(--border); background: var(--panel); color: var(--text); font-weight: 600; }
        .btn-accent { background: var(--accent); color: white; border: none; }
        .btn-accent:disabled { background: #333; cursor: not-allowed; opacity: 0.5; }
    </style>
</head>
<body>

<header>
    <div class="logo">‚úàÔ∏è MESTRE DAS <span>MILHAS</span></div>
    <div style="display: flex; align-items: center;">
        <button class="btn-test" onclick="bypassElite()">üß™ MOD TESTE (AULAS + NOTAS 10)</button>
        <div id="prog-txt" style="font-size: 12px; background: var(--panel); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--border);">0% Conclu√≠do</div>
    </div>
</header>

<main>
    <div class="content-area">
        <div class="video-container">
            <iframe id="mainPlayer" src=""></iframe>
            <button class="toggle-sidebar-btn" onclick="toggleSidebar()">‚ùÆ</button>
        </div>
        <div class="lesson-body">
            <h2 id="currentTitle">Carregando...</h2>
            <div class="nav-controls">
                <button onclick="changeLesson(-1)" style="margin-left:auto">Anterior</button>
                <button class="btn-accent" onclick="changeLesson(1)">Pr√≥xima Aula</button>
            </div>
            <div id="currentDesc"></div>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="modules-wrapper" id="moduleContainer"></div>
        <div class="final-exam-area">
            <button class="btn-accent" style="width:100%" onclick="window.location.href='/prova/final'" id="finalBtn" disabled>üéì ATIVIDADE FINAL (BLOQUEADA)</button>
        </div>
    </div>
</main>

<script>
    const course = [
        { name: "1. Fundamentos e CPM", lessons: [
            {t: "Vis√£o Geral 2026", d: "Entenda o mercado atual.", v: "3r6Q9tCzX4k"},
            {t: "Dicion√°rio do Milheiro", d: "Termos t√©cnicos essenciais.", v: "8pTEmbeENF4"},
            {t: "C√°lculo de CPM", d: "Matem√°tica do lucro.", v: "Z9z8Z2f3nGQ"},
            {t: "Livelo e Esfera", d: "Ac√∫mulo banc√°rio.", v: "yJz8QyYw7l8"},
            {t: "Cias A√©reas", d: "Diferen√ßas entre programas.", v: "p7HKvqRI_Bo"},
            {t: "Alertas T√©cnicos", d: "Monitoramento em tempo real.", v: "dZ9gY8JwqfE"},
            {t: "Primeiro Ac√∫mulo", d: "Passo a passo pr√°tico.", v: "5Y3G6a2Z8sU"}
        ]},
        { name: "2. Cart√µes e Benef√≠cios", lessons: [
            {t: "Ranking de Cart√µes", d: "Melhores cart√µes 2026.", v: "Qv2L8g1m3kM"},
            {t: "Zerar Anuidade", d: "Scripts de negocia√ß√£o.", v: "7J9x8w3QX2M"},
            {t: "Salas VIP", d: "LoungeKey e DragonPass.", v: "1b9QX5M0H8I"},
            {t: "Seguros Gratuitos", d: "Economia em viagens.", v: "L8z1p9Y0QH4"},
            {t: "Cooperativas", d: "Sicredi e Unicred.", v: "C8QZ3y9mF4s"},
            {t: "Upgrade de Limite", d: "Conquistando o Black.", v: "9X3ZLkQ8P2s"},
            {t: "Spread Zero", d: "Compras internacionais.", v: "M8LZ9Q2KX1A"},
            {t: "Prote√ß√£o de Pre√ßo", d: "Dinheiro de volta.", v: "wZ8L9Ck3m0E"}
        ]},
        { name: "3. Ac√∫mulo Estrat√©gico", lessons: [
            {t: "Compras 10x1", d: "10 pontos por real.", v: "P9Zk3L8QX4s"},
            {t: "Compra de Pontos", d: "An√°lise de custo.", v: "Q9ZL2X8M3F4"},
            {t: "B√¥nus de 100%", d: "Transfer√™ncia certa.", v: "dZ9gY8JwqfE"},
            {t: "Clubes de Milhas", d: "ROI de assinaturas.", v: "3r6Q9tCzX4k"},
            {t: "Milhas no Tanque", d: "Shell e Ipiranga.", v: "8pTEmbeENF4"},
            {t: "Parceiros Varejo", d: "Amazon e Magalu.", v: "Z9z8Z2f3nGQ"},
            {t: "Gest√£o de CPFs", d: "Escalando o ac√∫mulo.", v: "yJz8QyYw7l8"},
            {t: "Datas Sazonais", d: "Black Friday.", v: "p7HKvqRI_Bo"},
            {t: "Giro de Boletos", d: "Pontuando em contas.", v: "dZ9gY8JwqfE"}
        ]},
        { name: "4. Emiss√µes Internacionais", lessons: [
            {t: "Tabela Fixa", d: "Segredos da emiss√£o.", v: "5Y3G6a2Z8sU"},
            {t: "Classe Executiva", d: "Luxo barato.", v: "Qv2L8g1m3kM"},
            {t: "Stopover", d: "Destinos extras.", v: "7J9x8w3QX2M"},
            {t: "Iberia Plus", d: "Foco na Europa.", v: "1b9QX5M0H8I"},
            {t: "Regras de CPF", d: "Evitando bloqueios.", v: "L8z1p9Y0QH4"},
            {t: "Destinos EUA", d: "Miami e NY.", v: "C8QZ3y9mF4s"},
            {t: "Taxas de Combust√≠vel", d: "Identificando taxas.", v: "9X3ZLkQ8P2s"},
            {t: "ALL Accor", d: "Hot√©is com pontos.", v: "M8LZ9Q2KX1A"}
        ]},
        { name: "5. Milhas como Neg√≥cio", lessons: [
            {t: "Venda em Balc√£o", d: "Max e Hotmilhas.", v: "wZ8L9Ck3m0E"},
            {t: "Venda Particular", d: "Margem de lucro.", v: "P9Zk3L8QX4s"},
            {t: "Gest√£o de Lucro", d: "Planilha de controle.", v: "Q9ZL2X8M3F4"},
            {t: "Imposto de Renda", d: "Declara√ß√£o legal.", v: "dZ9gY8JwqfE"},
            {t: "Ag√™ncia Digital", d: "Sua pr√≥pria ag√™ncia.", v: "3r6Q9tCzX4k"},
            {t: "Reinvestimento", d: "Giro de capital.", v: "8pTEmbeENF4"},
            {t: "Tend√™ncias 2026", d: "Futuro do mercado.", v: "Z9z8Z2f3nGQ"},
            {t: "Mentoria Final", d: "Encerramento.", v: "yJz8QyYw7l8"}
        ]}
    ];

    let current = { m: 0, l: 0 };
    // Progress√£o local para interface
    let progress = JSON.parse(localStorage.getItem('mm_progress')) || { lessons: {}, exams: {1:0, 2:0, 3:0, 4:0, 5:0} };

    function init() {
        const container = document.getElementById('moduleContainer');
        container.innerHTML = "";
        course.forEach((mod, mIdx) => {
            const div = document.createElement('div');
            div.className = `module-item ${mIdx === 0 ? 'open' : ''}`;
            const lessonsHTML = mod.lessons.map((les, lIdx) => {
                const done = progress.lessons[les.v] === true;
                return `
                <div class="lesson-item ${done ? 'completed' : ''}" id="les-${les.v}" onclick="play(${mIdx}, ${lIdx})">
                    <input type="checkbox" ${done ? 'checked' : ''} onclick="event.stopPropagation(); toggleLesson('${les.v}')">
                    <span>${les.t}</span>
                </div>`;
            }).join('');
            
            div.innerHTML = `<button class="module-btn" onclick="this.parentElement.classList.toggle('open')">${mod.name} ‚ñæ</button>
                             <div class="lessons-list">${lessonsHTML}
                                <div class="lesson-item is-quiz" onclick="window.location.href='/prova/${mIdx+1}'">
                                    <span>üèÜ PROVA DO M√ìDULO ${mIdx+1}</span>
                                </div>
                             </div>`;
            container.appendChild(div);
        });
        play(0, 0);
        updateProgressUI();
    }

    async function bypassElite() {
        if(!confirm("Ativar Modo Teste? Isso marcar√° progresso local, mas voc√™ ainda precisar√° ter as notas no Banco de Dados para liberar o servidor.")) return;
        
        course.forEach(m => m.lessons.forEach(l => progress.lessons[l.v] = true));
        // Nota: O bypass local libera o bot√£o na UI, mas o servidor Tornado far√° a checagem real no GET de /prova/final
        localStorage.setItem('mm_progress', JSON.stringify(progress));
        
        alert("Modo Teste Local Ativado! Lembre-se que o acesso √† Prova Final √© validado pelo Servidor.");
        location.reload();
    }

    function play(m, l) {
        current = { m, l };
        const les = course[m].lessons[l];
        document.getElementById('mainPlayer').src = `https://www.youtube.com/embed/${les.v}?autoplay=1`;
        document.getElementById('currentTitle').innerText = les.t;
        document.getElementById('currentDesc').innerText = les.d;
        document.querySelectorAll('.lesson-item').forEach(e => e.classList.remove('active'));
        document.getElementById(`les-${les.v}`)?.classList.add('active');
    }

    function toggleLesson(videoId) {
        progress.lessons[videoId] = !progress.lessons[videoId];
        localStorage.setItem('mm_progress', JSON.stringify(progress));
        updateProgressUI();
        init();
    }

    function updateProgressUI() {
        let total = 0, done = 0;
        course.forEach(m => m.lessons.forEach(l => { total++; if(progress.lessons[l.v]) done++; }));
        const percent = Math.round((done / total) * 100);
        document.getElementById('prog-txt').innerText = `${percent}% Conclu√≠do`;
        
        // O bot√£o final aponta para /prova/final que √© controlado pelo ProvaFinalHandler no Python
        const btn = document.getElementById('finalBtn');
        btn.disabled = (percent < 100); 
        btn.innerText = (percent < 100) ? "üéì ATIVIDADE FINAL (BLOQUEADA)" : "üöÄ ACESSAR PROVA FINAL";
    }

    function changeLesson(step) {
        const next = current.l + step;
        if(course[current.m].lessons[next]) play(current.m, next);
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('closed');
    }

    init();
</script>
</body>
</html>

