<div class="checkout-container">
    <h2>Pagamento</h2>
    <div class="payment-methods">
        <form action="/confirmar_pagamento" method="POST">
            <input type="hidden" name="metodo" value="PIX">
            <button type="submit" class="btn-payment btn-pix">Gerar Pix para Pagamento</button>
        </form>
    </div>
</div>

{% if qr_img %}
<div class="modal-overlay" style="display: flex; position: fixed; inset: 0; background: rgba(0,0,0,0.9); align-items: center; justify-content: center; z-index: 9999;">
    <div class="modal-content" style="background: #fff; padding: 30px; border-radius: 12px; text-align: center; color: #000; width: 320px;">
        <h3 style="font-size: 1rem; margin-bottom: 15px;">Escaneie o QR Code</h3>
        <img src="data:image/png;base64, {{ qr_img }}" style="width: 200px; height: 200px; margin-bottom: 15px;">
        <div style="background: #f4f4f5; padding: 10px; font-size: 0.7rem; word-break: break-all; border: 1px solid #ddd; margin-bottom: 10px;">{{ pix_code }}</div>
        <p style="font-size: 0.8rem; color: #16a34a; font-weight: bold;">Aguardando confirmação...</p>
        <button onclick="window.location.href='/pagamento'" style="margin-top: 15px; cursor: pointer; background: none; border: none; color: #71717a; font-size: 0.8rem;">Fechar</button>
    </div>
</div>

<script>
    // Inicia o rastreio automático apenas se o QR Code existir
    setInterval(async () => {
        try {
            const res = await fetch('/check-status');
            const data = await res.json();
            if (data.status === 'pago') window.location.href = '/curso';
        } catch (e) {}
    }, 3000);
</script>
{% end %}