# ARQUIVO: .env

# Chaves de API do Google OAuth 2.0 (Valores confirmados no seu Google Cloud Console)
GOOGLE_CLIENT_ID="899997122020-0v0hokvnet5l9nnt1cufg071tbq60rdc.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="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"

# Segredo de cookie principal para o Tornado (Escolha um valor forte ou use secrets.token_urlsafe(32) no código)
TORNADO_COOKIE_SECRET="seu_segredo_unico_de_40_caracteres"

Link pra poder ter acesso a recuperação de senha:

Nome do app: Cursos - Oline
Senha gerada: djzq ziax zdkn heyt 

EMAIL_USER = "suporte.cursos.onlin0@gmail.com"
EMAIL_PASS = "cursos--oline"



EMAIL_USER = "chrstnposso@gmail.com"
EMAIL_PASS = "smaw uhli vhdi ywff "  # <- senha de app do Gmail




User_dev = "15"
Senha_dev = "15"
Email_dev = "desenvolvedor015@gmail.com"

Email_dev_google = "desenvolvedor015@gmail.com"
Senha_email_dev = "15102011C"


senha: recuprerar_senha
email: recuperar.curso@gmail.com



      
            6: { # Gabarito Final 50 Questões
                "q1":"a","q2":"c","q3":"b","q4":"d","q5":"a","q6":"c","q7":"b","q8":"a","q9":"d","q10":"c",
                "q11":"b","q12":"a","q13":"d","q14":"c","q15":"b","q16":"a","q17":"d","q18":"b","q19":"c","q20":"a",
                "q21":"c","q22":"b","q23":"d","q24":"a","q25":"c","q26":"b","q27":"d","q28":"a","q29":"c","q30":"b",
                "q31":"d","q32":"a","q33":"c","q34":"b","q35":"d","q36":"a","q37":"c","q38":"b","q39":"d","q40":"a",
                "q41":"b","q42":"c","q43":"a","q44":"d","q45":"b","q46":"c","q47":"a","q48":"d","q49":"b","q50":"c"
            }
        }






class CertificadoPDFHandler(tornado.web.RequestHandler):
    def get(self):
        user_id = self.get_secure_cookie("user_id")
        nome_cookie = self.get_secure_cookie("user")

        if not user_id or not nome_cookie:
            self.redirect("/login")
            return

        user_id = int(user_id.decode())
        nome_aluno = nome_cookie.decode().upper()

        # Conexão com o Banco
        conn = sqlite3.connect(os.path.join(os.path.abspath(os.getcwd()), "usuarios.db"))
        conn.row_factory = sqlite3.Row
        c = conn.cursor()
        c.execute("SELECT inicio_curso, fim_modulo1 FROM users WHERE id = ?", (user_id,))
        dados = c.fetchone()
        conn.close()

        if not dados or not dados["fim_modulo1"]:
            self.redirect("/curso")
            return

        buffer = BytesIO()
        p = canvas.Canvas(buffer, pagesize=landscape(A4))
        w, h = landscape(A4)

        # --- 1. FUNDO E MOLDURA ---
        p.setFillColor(HexColor("#050505")) # Fundo Black Premium
        p.rect(0, 0, w, h, fill=1)

        # Marca d'água central
        p.setFont("Helvetica-Bold", 140)
        p.setFillColor(HexColor("#0A0A0A"))
        p.drawCentredString(w/2, h/2 - 50, "MILHASPRO")

        # Bordas Douradas
        p.setStrokeColor(HexColor("#d4af37"))
        p.setLineWidth(12)
        p.rect(25, 25, w-50, h-50, stroke=1, fill=0)
        p.setLineWidth(1)
        p.rect(40, 40, w-80, h-80, stroke=1, fill=0)

        # --- 2. CABEÇALHO ---
        p.setFillColor(HexColor("#ffffff"))
        p.setFont("Helvetica-Bold", 22)
        p.drawCentredString(w/2, h - 90, "MILHASPRO")

        # --- 3. TÍTULO PRINCIPAL ---
        p.setFillColor(HexColor("#f1d592")) # Dourado Claro
        p.setFont("Helvetica-Bold", 55)
        p.drawCentredString(w/2, h - 170, "CERTIFICADO")
        
        p.setFillColor(HexColor("#888888"))
        p.setFont("Helvetica", 12)
        p.drawCentredString(w/2, h - 195, "DE CONCLUSÃO E ESPECIALIZAÇÃO EM MILHAS AÉREAS")

        # --- 4. TEXTO DE CERTIFICAÇÃO ---
        p.setFillColor(HexColor("#cccccc"))
        p.setFont("Helvetica", 18)
        p.drawCentredString(w/2, h/2 + 35, "Certificamos que para os devidos fins de direito")

        # Nome do Aluno
        p.setFillColor(HexColor("#ffffff"))
        p.setFont("Helvetica-Bold", 38)
        p.drawCentredString(w/2, h/2 - 20, nome_aluno)
        
        # Linha Dourada sob o nome
        p.setStrokeColor(HexColor("#d4af37"))
        p.setLineWidth(2)
        p.line(w/2 - 200, h/2 - 30, w/2 + 200, h/2 - 30)

        # Texto de Conclusão
        p.setFillColor(HexColor("#aaaaaa"))
        p.setFont("Helvetica", 14)
        p.drawCentredString(w/2, h/2 - 70, "concluiu com êxito o treinamento MilhasPro - O Método Definitivo,")
        p.drawCentredString(w/2, h/2 - 90, "dominando as estratégias elite de acúmulo e emissões de luxo.")

        # --- 5. RODAPÉ E ASSINATURAS ---
        p.setStrokeColor(HexColor("#444444"))
        p.setLineWidth(1)

        # Lado Esquerdo: Direção
        p.line(120, 110, 320, 110)
        p.setFillColor(HexColor("#ffffff"))
        p.setFont("Helvetica-Bold", 10)
        p.drawCentredString(220, 95, "DIRETOR EXECUTIVO")
        p.setFillColor(HexColor("#666666"))
        p.setFont("Helvetica", 8)
        p.drawCentredString(220, 82, "Gestão Estratégica MilhasPro")

        # Centro: Selo de Autenticidade
        p.setFillColor(HexColor("#d4af37"))
        p.setFont("Helvetica-Bold", 11)
        data_atual = datetime.now().strftime('%d/%m/%Y')
        p.drawCentredString(w/2, 60, f"AUTENTICADO EM {data_atual}")

        # Lado Direito: Coordenação
        p.line(w-320, 110, w-120, 110)
        p.setFillColor(HexColor("#ffffff"))
        p.setFont("Helvetica-Bold", 10)
        p.drawCentredString(w-220, 95, "COORDENAÇÃO TÉCNICA")
        p.setFillColor(HexColor("#666666"))
        p.setFont("Helvetica", 8)
        p.drawCentredString(w-220, 82, "Núcleo de Inteligência e Emissões")

        p.showPage()
        p.save()

        buffer.seek(0)
        self.set_header("Content-Type", "application/pdf")
        self.set_header("Content-Disposition", "attachment; filename=Certificado_MilhasPro_Elite.pdf")
        self.write(buffer.read())
        self.finish()














































comando do curso.html: 



<!DOCTYPE html>
    <html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Curso de Milhas — Plataforma de Aprendizado Avançada</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <link rel="stylesheet" href="/static/css/curso.css">]

        
    </head>
    <style>
/* =========================================
   VARIÁVEIS E SETUP PREMIUM
   ========================================= */
:root {
    --gold: linear-gradient(90deg, #d4af37 0%, #f1d592 50%, #d4af37 100%);
    --gold-solid: #d4af37;
    --dark-bg: #050505;
    --card-bg: #111111;
    --text-gray: #aaa;
    --border-gold: rgba(212, 175, 55, 0.2);
}

* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
    font-family: 'Inter', sans-serif; 
    scroll-behavior: smooth; 
}

body { 
    background-color: var(--dark-bg); 
    color: #fff; 
    line-height: 1.6; 
    padding-top: 100px; /* Espaço para o header fixo */
    min-height: 100vh;
}

/* =========================================
   HEADER & LOGO
   ========================================= */
header {
    padding: 15px 8%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(10px);
    position: fixed;
    top: 0; width: 100%;
    z-index: 1000;
    border-bottom: 1px solid var(--border-gold);
}

.logo { font-weight: 800; font-size: 26px; letter-spacing: -1px; text-decoration: none; color: #fff; }
.logo span { 
    background: var(--gold); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
}

/* =========================================
   DASHBOARD & CONTAINER PRINCIPAL
   ========================================= */
.container {
    width: 95%;
    max-width: 1300px;
    margin: 0 auto;
    padding: 20px;
    animation: fadeIn 0.6s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
}

h2 {
    text-align: center;
    font-size: 38px;
    font-weight: 800;
    background: var(--gold);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 30px;
}

.global-progress-dashboard {
    background: var(--card-bg);
    padding: 30px;
    border-radius: 20px;
    margin-bottom: 40px;
    display: flex;
    justify-content: space-around;
    border: 1px solid var(--border-gold);
    box-shadow: 0 15px 35px rgba(0,0,0,0.6);
}

.status-item h4 { color: var(--text-gray); font-size: 13px; text-transform: uppercase; letter-spacing: 2px; }
.status-item span { font-size: 32px; font-weight: 800; color: #f1d592; }
.status-item .completed-text { color: #00ff88; }

/* =========================================
   GRID DE MÓDULOS (ESTILO BLACK CARD)
   ========================================= */
.course-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
}

.course-card {
    position: relative;
    background: var(--card-bg);
    padding: 40px 25px 25px;
    border-radius: 20px;
    border: 1px solid #222;
    overflow: hidden;
    transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex;
    flex-direction: column;
}

.course-card:hover {
    transform: translateY(-10px);
    border-color: var(--gold-solid);
    box-shadow: 0 20px 40px rgba(212, 175, 55, 0.15);
}

/* Número do Módulo no Fundo */
.course-card::before {
    content: "VIP"; /* Ou você pode usar JS para colocar o número do módulo aqui */
    position: absolute;
    top: 10px;
    left: 15px;
    font-size: 60px;
    font-weight: 900;
    background: var(--gold);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    opacity: 0.05;
}

.course-card h3 {
    color: #f1d592;
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 15px;
    z-index: 1;
}

.course-card p {
    color: #999;
    font-size: 14px;
    margin-bottom: 20px;
    line-height: 1.5;
}

/* =========================================
   LISTA DE AULAS INTERNA
   ========================================= */
.lesson-item-wrapper {
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
    margin-bottom: 10px;
    padding: 12px 15px;
    border: 1px solid rgba(255,255,255,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: 0.3s;
}

.lesson-item-wrapper:hover {
    background: rgba(212, 175, 55, 0.08);
    border-color: rgba(212, 175, 55, 0.3);
}

.lesson-list a {
    color: #eee;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
}

.lesson-list a.watched { color: #00ff88; font-weight: 700; }

/* =========================================
   BARRAS DE PROGRESSO (GOLD)
   ========================================= */
.progress-container { margin-top: auto; padding-top: 20px; }
.progress-bar-container { 
    height: 6px; 
    background: #222; 
    border-radius: 10px; 
    overflow: hidden; 
}

.progress-bar { 
    height: 100%; 
    background: var(--gold); 
    width: 0%; 
    transition: 0.8s ease; 
}

.progress-label {
    font-size: 12px;
    color: var(--gold-solid);
    text-align: right;
    margin-top: 8px;
    font-weight: 800;
    text-transform: uppercase;
}

/* =========================================
   BOTÕES DE AÇÃO (PAGAMENTO / LOGIN)
   ========================================= */
.course-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 40px;
}

.course-actions a {
    text-decoration: none;
    padding: 15px 30px;
    border-radius: 12px;
    font-weight: 800;
    text-transform: uppercase;
    font-size: 14px;
    transition: 0.3s;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Botão Pagamento (Dourado) */
.course-actions a[href="/pagamento"] {
    background: var(--gold);
    color: #000;
}

.course-actions a[href="/pagamento"]:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px rgba(212, 175, 55, 0.4);
}

/* Botão Login (Dark) */
.course-actions a[href="/login"] {
    background: #1a1a1a;
    color: #fff;
    border: 1px solid #333;
}

.course-actions a[href="/login"]:hover {
    border-color: var(--gold-solid);
    color: var(--gold-solid);
}

/* =========================================
   MODAL DE VÍDEO PREMIUM
   ========================================= */
.modal-content {
    background: #0f0f0f;
    border: 1px solid var(--gold-solid);
    border-radius: 20px;
    box-shadow: 0 0 50px rgba(0,0,0,1);
}

.complete-video-btn {
    background: var(--gold) !important;
    color: #000 !important;
    font-weight: 900 !important;
    text-transform: uppercase;
    border: none;
}

/* =========================================
   RESPONSIVIDADE
   ========================================= */
@media (max-width: 900px) {
    .course-grid { grid-template-columns: 1fr; }
    .global-progress-dashboard { flex-direction: column; gap: 20px; }
    .course-actions { flex-direction: column; align-items: center; }
    .course-actions a { width: 100%; max-width: 300px; }
}
:root {
    --gold: linear-gradient(90deg, #d4af37 0%, #f1d592 50%, #d4af37 100%);
    --dark-bg: #050505;
    --card-bg: #111111;
    --text-gray: #aaa;
}

* { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; scroll-behavior: smooth; }
body { background-color: var(--dark-bg); color: #fff; line-height: 1.6; padding-top: 80px; }

/* HEADER PREMIUM */
header {
    padding: 15px 8%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(10px);
    position: fixed;
    top: 0; width: 100%;
    z-index: 1000;
    border-bottom: 1px solid rgba(212,175,55,0.1);
}
.logo { font-weight: 800; font-size: 24px; letter-spacing: -1px; text-decoration: none; color: #fff; }
.logo span { background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

/* DASHBOARD DE PROGRESSO */
.global-progress-dashboard {
    background: var(--card-bg);
    padding: 30px;
    border-radius: 15px;
    margin: 40px auto;
    max-width: 1200px;
    display: flex;
    justify-content: space-around;
    border: 1px solid rgba(212,175,55,0.2);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.status-item h4 { color: var(--text-gray); font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
.status-item span { font-size: 28px; font-weight: 800; color: #f1d592; }

/* GRID DE MÓDULOS */
.grid-modules {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto 100px;
    padding: 0 20px;
}

.module-card {
    position: relative;
    background: var(--card-bg);
    padding: 50px 30px 30px;
    border-radius: 15px;
    border: 1px solid #222;
    overflow: hidden;
    transition: 0.4s;
    box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
}

.module-card:hover {
    transform: translateY(-10px);
    border-color: #d4af37;
    box-shadow: 0 20px 40px rgba(212,175,55,0.2);
}

.module-number {
    position: absolute;
    top: 10px;
    left: 15px;
    font-size: 80px;
    font-weight: 900;
    background: var(--gold);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    opacity: 0.1;
    z-index: 0;
}

.module-card h3 {
    color: #f1d592;
    margin-bottom: 15px;
    font-size: 1.5rem;
    font-weight: 700;
    position: relative;
    z-index: 1;
}

.module-card p {
    color: #ccc;
    font-size: 0.95rem;
    margin-bottom: 25px;
}

/* LISTA DE AULAS INTERNA */
.lesson-list { border-top: 1px solid #222; padding-top: 20px; margin-bottom: 20px; }
.lesson-item-wrapper { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
.lesson-item-wrapper a { color: #eee; text-decoration: none; font-size: 14px; transition: 0.3s; }
.lesson-item-wrapper a:hover { color: #d4af37; }
.lesson-item-wrapper a.watched { color: #00ff88; font-weight: 600; }

/* BARRA DE PROGRESSO DO CARD */
.progress-container { margin-top: auto; }
.progress-bar-container { height: 6px; background: #222; border-radius: 10px; overflow: hidden; margin-top: 10px; }
.progress-bar { height: 100%; background: var(--gold); width: 0%; transition: 0.5s; }

/* BOTÕES AUXILIARES */
.unwatch-btn { background: none; border: 1px solid #444; color: #777; font-size: 10px; padding: 3px 8px; border-radius: 5px; cursor: pointer; }
.unwatch-btn:hover { border-color: #ff3c3c; color: #ff3c3c; }

@media (max-width: 768px) {
    .global-progress-dashboard { flex-direction: column; gap: 20px; text-align: center; }
}



:root {
    --gold-premium: linear-gradient(135deg, #d4af37 0%, #f1d592 50%, #d4af37 100%);
    --bg-black: #080808;
    --card-gray: #121212;
    --text-white: #ffffff;
}

/* Ajuste do Container Principal */
.container {
    background: var(--bg-black);
    border: 1px solid rgba(212, 175, 55, 0.1);
    box-shadow: 0 20px 50px rgba(0,0,0,0.9);
}

/* Grid de Módulos mais espaçado */
.course-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
}

/* Card do Módulo Estilo "Black Card" */
.course-card {
    background: var(--card-gray);
    border: 1px solid #222;
    border-radius: 20px;
    padding: 30px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.course-card:hover {
    border-color: #d4af37;
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(212, 175, 55, 0.1);
}

/* Título do Módulo em Destaque */
.course-card h3 {
    color: #f1d592;
    font-size: 1.4rem;
    margin-bottom: 15px;
    font-weight: 700;
}

/* Lista de aulas mais limpa */
.lesson-item-wrapper {
    background: rgba(255,255,255,0.03);
    border-radius: 8px;
    margin-bottom: 8px;
    padding: 10px 15px;
    border: 1px solid transparent;
}

.lesson-item-wrapper:hover {
    background: rgba(212, 175, 55, 0.05);
    border-color: rgba(212, 175, 55, 0.2);
}

/* Barra de progresso fina e elegante na base do card */
.progress-bar-container {
    height: 4px;
    background: #222;
    margin-top: 20px;
}

.progress-bar {
    background: var(--gold-premium);
}
.lock-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    margin-left: 8px;
    border-radius: 4px;
    font-size: 12px;
    color: #bbb;
}
.locked {
    background: rgba(255,90,90,0.06);
    color: #ff6b6b;
    border: 1px solid rgba(255,90,90,0.12);
}
.unlocked {
    background: rgba(0,200,120,0.06);
    color: #7ef5b7;
    border: 1px solid rgba(0,200,120,0.12);
}
.lock-overlay {
    pointer-events: none; /* just visual */
    opacity: 0.95;
}






    * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Inter', sans-serif;
            }

            body {
                min-height: 100vh;
                
                background: #0d0d0d;
                color: #e6e6e6;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 40px;
            }

            .container {
                width: 90%;
                max-width: 1300px; 
                background: #111;
                padding: 40px;
                border-radius: 16px;
                box-shadow: 0 0 40px #FFC222(0, 0, 0, 0.6);
                border: 1px solid #FFC222(255, 255, 255, 0.05);
                animation: fadeIn 0.4s ease;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }

            h2 {
                text-align: center;
                margin-bottom: 10px;
                font-weight: 800;
                color: #777;
                letter-spacing: 0.5px;
                font-size: 36px;
            }
            
            .header-controls {
                display: flex;
                justify-content: flex-end;
                margin-bottom: 20px;
            }

            .logout-btn {
                background: yellow;
                color: yellow;
                border: 1px solid yellow;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 500;
                transition: background 0.3s, color 0.3s;
                text-decoration: none; 
                font-size: 14px;
            }

            .logout-btn:hover {
                background: #777;
                color: #111;
                border-color: #777;
            }


            .welcome-message {
                text-align: center;
                margin-bottom: 40px;
                font-size: 18px;
                font-weight: 500;
                color: #aaa;
            }

            .global-progress-dashboard {
                background: #1a1a1a;
                padding: 20px;
                border-radius: 12px;
                margin-bottom: 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-left: 5px solid #777;
            }

            .status-item {
                text-align: center;
                padding: 0 20px;
            }

            .status-item h4 {
                font-size: 14px;
                color: #aaa;
                margin-bottom: 5px;
                font-weight: 500;
            }

            .status-item span {
                font-size: 24px;
                font-weight: 700;
                color: #e6e6e6;
            }

            .status-item .completed-text {
                color: #00ff88;
            }

            .course-grid-wrapper {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .course-grid {
                display: grid;
                gap: 20px;
                grid-template-columns: repeat(4, 1fr); 
                margin-bottom: 10px;
                transition: opacity 0.3s ease;
            }

            .course-card {
                background: #1a1a1a;
                padding: 25px;
                border-radius: 12px;
                position: relative;
                transition: transform 0.3s, box-shadow 0.3s;
                border: 1px solid #222;
                display: flex; 
                flex-direction: column; 
            }

            .course-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            }

            .course-card h3 {
                margin-bottom: 8px;
                font-size: 20px;
                color: #ffffff;
            }

            .course-card p {
                font-size: 14px;
                color: #aaa;
                margin-bottom: 15px;
                min-height: 40px; 
            }

            .lesson-list, .activity-list {
                padding-bottom: 15px;
            }
            
            .lesson-list {
                border-bottom: 1px solid #222;
                margin-bottom: 15px;
            }
            
            .activity-list-title {
                font-size: 16px;
                font-weight: 600;
                color: #777;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .lesson-item-wrapper {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
                font-size: 15px;
                padding: 5px 0;
            }

            .lesson-list a, .activity-list a {
                display: flex;
                align-items: center;
                color: #ffffff;
                text-decoration: none;
                transition: 0.2s;
                cursor: pointer;
                flex-grow: 1;
            }

            .lesson-list a:hover, .activity-list a:hover {
                color: #777;
            }
            
            .lesson-list a.watched, .activity-list a.watched {
                color: #00ff88;
                opacity: 0.8;
                font-weight: 500;
            }
            
            .lesson-icon {
                margin-right: 8px;
                width: 15px;
                text-align: center;
            }
            
            .unwatch-btn {
                background: none;
                border: 1px solid #333;
                color: #aaa;
                padding: 2px 5px;
                border-radius: 4px;
                font-size: 10px;
                font-weight: 600;
                cursor: pointer;
                margin-left: 10px;
                opacity: 0.5;
                transition: opacity 0.2s, color 0.2s, border-color 0.2s;
                display: none; 
            }

            .unwatch-btn:hover {
                opacity: 1;
                color: #ff5757;
                border-color: #ff5757;
            }


            .progress-container {
                margin-top: auto; 
                padding-top: 15px;
            }
            
            .progress-bar-container {
                height: 8px;
                background: #333;
                border-radius: 4px;
                margin-top: 12px;
            }

            .progress-bar {
                height: 100%;
                background: linear-gradient(90deg, #777, #777);
                border-radius: 4px;
                transition: width 0.5s ease;
            }

            .progress-bar.completed {
                background: linear-gradient(90deg, #00ff88, #00b362);
            }

            .progress-label {
                font-size: 14px;
                color: #e6e6e6;
                text-align: right;
                margin-top: 5px;
                font-weight: 600;
            }
            
            .progress-label.completed {
                color: #00ff88;
            }
            
            .pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 15px;
                margin-top: 30px;
            }

            .page-button {
                background: #1a1a1a;
                color: #777;
                border: 1px solid #ffffff;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
                transition: background 0.3s, color 0.3s;
            }

            .page-button:hover:not(:disabled) {
                background: #ffffff;
                color: #111;
            }
            
            .page-button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
                border-color: #333;
                color: #777;
                background: #111;
            }

            .page-indicator {
                font-size: 18px;
                font-weight: 500;
            }
            
            .page {
                display: none;
            }
            
            .page.active-page {
                display: grid;
            }

            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9); 
                display: none; 
                justify-content: center;
                align-items: center;
                z-index: 1000;
                opacity: 0;
                transition: opacity 0.3s ease;
                overflow-y: auto; 
            }

            .modal-overlay.open {
                display: flex;
                opacity: 1;
            }

            .modal-content {
                background: #1a1a1a;
                padding: 30px;
                border-radius: 12px;
                width: 90%;
                max-width: 700px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
                transform: scale(0.9);
                transition: transform 0.3s ease;
                position: relative;
                margin: 20px 0; 
            }
            
            #video-modal .modal-content {
                max-width: 1000px; 
                padding: 20px;
            }


            .modal-overlay.open .modal-content {
                transform: scale(1);
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid #2e2e2e;
                padding-bottom: 15px;
                margin-bottom: 20px;
            }

            .modal-header h3 {
                color: #ffffff;
                font-size: 24px;
            }

            .modal-body p {
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 25px;
                color: #ccc;
            }
            
            .modal-close-btn {
                background: none;
                border: none;
                color: #aaa;
                font-size: 24px;
                cursor: pointer;
                transition: color 0.2s;
            }

            .modal-close-btn:hover {
                color: #ffffff;
            }
            
            .complete-activity-btn, .complete-video-btn { 
                display: block;
                width: 100%;
                padding: 15px;
                background: #777; 
                color: #111;
                border: none;
                border-radius: 8px;
                font-size: 18px;
                font-weight: 700;
                cursor: pointer;
                transition: background 0.2s, opacity 0.2s;
                margin-top: 20px;
            }
            
            .complete-activity-btn:hover:not(.completed), .complete-video-btn:hover:not(.completed) {
                background: #ffffff;
            }
            
            .complete-activity-btn.completed, .complete-video-btn.completed {
                background: #00ff88; 
                color: #111;
                cursor: default;
            }
            
            .activity-input-area {
                margin-top: 15px;
                margin-bottom: 25px;
            }
            
            .activity-input-area h4 {
                color: #e6e6e6;
                margin-bottom: 10px;
            }

            .activity-input-area textarea {
                width: 100%;
                min-height: 150px;
                padding: 15px;
                border-radius: 8px;
                border: 1px solid #333;
                background: #222;
                color: #e6e6e6;
                font-size: 16px;
                resize: vertical;
            }
            
            .activity-feedback-area {
                margin-top: 20px;
                padding: 15px;
                border-radius: 8px;
                background: #0d0d0d;
                border: 1px solid #333;
                white-space: pre-wrap;
                font-family: monospace;
                font-size: 14px;
                min-height: 50px;
            }
            
            .feedback-success {
                border-color: #00ff88;
                color: #00ff88;
            }

            .feedback-failure {
                border-color: #ff5757;
                color: #ff5757;
            }

            .video-player-container {
                position: relative;
                width: 100%;
                padding-bottom: 56.25%; 
                height: 0;
                overflow: hidden;
                background: #000;
                border-radius: 8px;
            }

            .video-player-container iframe {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border: none;
            }

            /* NOVO CSS PARA .course-actions */
            /* Estilos para centralizar e formatar as ações da página */
            .course-actions {
                display: flex;
                justify-content: center; /* Centraliza os botões horizontalmente */
                gap: 20px; /* Espaço entre os botões */
                margin-top: 20px;
                margin-bottom: 40px; /* Espaço após o bloco de ações, antes do dashboard */
            }

            .course-actions a {
                /* Estilo de botão genérico */
                text-decoration: none;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                transition: all 0.3s;
                
                /* Alinhamento de conteúdo (ícone + texto) */
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 16px;
                min-width: 200px; /* Para garantir que tenham uma largura mínima e uniforme */
                justify-content: center; /* Centraliza o texto dentro do botão */
            }

            /* Estilo do botão de "Voltar ao Login" (Secundário) */
            .course-actions a[href="/login"] {
                background: #1a1a1a;
                color: #FFC222;
                border: 1px solid #333;
            }

            .course-actions a[href="/login"]:hover {
                background: #2e2e2e;
                color: #e6e6e6;
                border-color: #555;
            }

            /* Estilo do botão de "Página de Pagamentos" (Primário) */
            .course-actions a[href="/pagamento"] {
                background: #777; /* Cor de destaque (do tema do progresso) */
                color: #111;
                border: 1px solid #777;
            }

            .course-actions a[href="/pagamento"]:hover {
                background: #ffffff;
                border-color: #FFC222;
            }

            /* FIM DO NOVO CSS */

            @media (max-width: 1200px) {
                .course-grid {
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                }
            }
            
            @media (max-width: 600px) {
                /* Adicionado responsividade para os botões em telas pequenas */
                .course-actions {
                    flex-direction: column;
                    gap: 10px;
                }
                .course-actions a {
                    min-width: 100%;
                }
                /* Fim da responsividade para botões */

                .container {
                    padding: 30px 20px;
                    width: 100%;
                }
                h2 {
                    font-size: 26px;
                }
                .course-grid {
                    grid-template-columns: 1fr;
                }
                .global-progress-dashboard {
                    flex-direction: column;
                    gap: 15px;
                }
                .modal-content {
                    padding: 20px;
                }
                .modal-header h3 {
                    font-size: 20px;
                }
            }
    </style>

<div class="page-wrapper">

    <div class="container">

        <h2>Curso de Python 3 e Criação de APIs</h2>
        <p class="subtitle">
            Aprenda Python do zero, progredindo para se tornar um desenvolvedor backend completo.
        </p>

<div class="course-actions">
    <a href="/login">
        <i class="fas fa-arrow-left"></i>
        Voltar ao Login
    </a>

    <a href="/pagamento">
        <i class="fas fa-credit-card"></i>
        Página de pagamentos
    </a>

</div>
            

            <div class="global-progress-dashboard">
                <div class="status-item">
                    <h4><i class="fas fa-list-check"></i> Itens Concluídos (Vídeos + Atividades)</h4>
                    <span id="global-watched-count">0</span>
                </div>
                <div class="status-item">
                    <h4><i class="fas fa-check-double"></i> Módulos Concluídos</h4>
                    <span id="global-modules-count">0/20</span>
                </div>
                <div class="status-item">
                    <h4><i class="fas fa-chart-line"></i> Progresso Total</h4>
                    <span id="global-progress-percent" class="completed-text">0%</span>
                </div>
            </div>
            <div class="course-grid-wrapper">

                <div class="course-grid page active-page" data-page="1">
                    
                    <div class="course-card" data-module-id="1">
                        <h3>Módulo 1 — Fundamentos de Python</h3>
                        <p>Aprenda o básico da linguagem: sintaxe, variáveis e controle de fluxo.</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="1-1" data-video-url="https://youtu.be/S9uPNppGsGo" data-video-title="Aula 1 — Introdução ao Python"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução ao Python</a>
                                <button class="unwatch-btn" data-lesson-id="1-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="1-2" data-video-url="https://youtu.be/nJkVHusJp6E" data-video-title="Aula 2 — Variáveis e Tipos"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Variáveis e Tipos</a>
                                <button class="unwatch-btn" data-lesson-id="1-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="1-3" data-video-url="https://www.youtube.com/watch?v=VuKvR1J2LQE" data-video-title="Aula 3 — Condicionais (if/else)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — Instalando o Python3 e o IDLE</a>
                                <button class="unwatch-btn" data-lesson-id="1-3">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="1-4" data-video-url="https://youtu.be/XKHEtdqhLK8" data-video-title="Aula 4 — Loops (for/while)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 4 — Loops (for/while)</a>
                                <button class="unwatch-btn" data-lesson-id="1-4">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="1-5" data-video-url="https://www.youtube.com/watch?v=ElRd0cbXIv4" data-video-title="Aula 5 —  Instalando o PyCharm e o QPython3"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 5 — Estruturas de Dados Básicas</a>
                                <button class="unwatch-btn" data-lesson-id="1-5">Desmarcar</button>
                            </div>
                        </div>
                        
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="1-A1" data-activity-title="Mini-Desafio 1 — Calculadora de IMC" data-activity-desc="Crie uma função chamada 'calcular_imc(peso, altura)' que retorne o valor do IMC. O backend irá testar sua função com diversos inputs."><span class="lesson-icon"><i class="far fa-circle"></i></span> Mini-Desafio 1 — Calculadora de IMC</a>
                                <button class="unwatch-btn" data-lesson-id="1-A1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="1-A2" data-activity-title="Desafio — Inverter String" data-activity-desc="Crie uma função chamada 'inverter_string(texto)' que receba uma string e retorne a mesma string invertida (ex: 'Python' -> 'nohtyP')."><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Inverter String</a>
                                <button class="unwatch-btn" data-lesson-id="1-A2">Desmarcar</button>
                            </div>
                        </div>

                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-1" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-1">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="2">
                        <h3>Módulo 2 — Python Avançado</h3>
                        <p>Se aprofunde em funções, classes, módulos e gerenciamento de erros.</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="2-1" data-video-url="https://www.youtube.com/watch?v=O6vyUeDteRA&list=PLsMpSZTgkF5ANrrp31dmQoG0-hPoI-NoX&index=2" data-video-title="Aula 1 — List comprehensions"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Funções Avançadas e Lambdas</a>
                                <button class="unwatch-btn" data-lesson-id="2-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="2-2" data-video-url="https://www.youtube.com/watch?v=eDWc2xv_t_M&list=PLsMpSZTgkF5ANrrp31dmQoG0-hPoI-NoX&index=3" data-video-title="Aula 2 — Programação Orientada a Objetos"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Programação Orientada a Objetos</a>
                                <button class="unwatch-btn" data-lesson-id="2-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="2-3" data-video-url="https://youtu.be/oF6jEN4Y3as" data-video-title="Aula 3 — Tratamento de Erros (try/except)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — Tratamento de Erros (try/except)</a>
                                <button class="unwatch-btn" data-lesson-id="2-3">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="2-4" data-video-url="https://youtu.be/8p1lZUg1SqI" data-video-title="Aula 4 — Módulos e Pacotes"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 4 — Módulos e Pacotes</a>
                                <button class="unwatch-btn" data-lesson-id="2-4">Desmarcar</button>
                            </div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="2-A1" data-activity-title="Desafio — Criar uma Classe de Banco" data-activity-desc="Implemente a classe 'ContaBancaria' com método 'saque(valor)' que levante uma exceção 'SaldoInsuficienteError' se o valor for maior que o saldo. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Criar uma Classe de Banco</a>
                                <button class="unwatch-btn" data-lesson-id="2-A1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="2-A2" data-activity-title="Desafio — Contador de Palavras" data-activity-desc="Crie uma função 'contar_palavras(texto)' que retorne um dicionário com a contagem de cada palavra no texto, ignorando maiúsculas/minúsculas. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Contador de Palavras</a>
                                <button class="unwatch-btn" data-lesson-id="2-A2">Desmarcar</button>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-2" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-2">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="3">
                        <h3>Módulo 3 — APIs com FastAPI</h3>
                        <p>Crie APIs RESTful modernas usando o framework Python mais rápido.</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="3-1" data-video-url="https://youtu.be/0sOvCWFmrtA" data-video-title="Aula 1 — Introdução e Configuração"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução e Configuração</a>
                                <button class="unwatch-btn" data-lesson-id="3-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="3-2" data-video-url="https://youtu.be/0RS5WlH9YdQ" data-video-title="Aula 2 — Rotas, Métodos HTTP e Path Parameters"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Rotas, Métodos HTTP e Path Parameters</a>
                                <button class="unwatch-btn" data-lesson-id="3-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="3-3" data-video-url="https://youtu.be/G8nDxzgcj9Q" data-video-title="Aula 3 — Schema Validation com Pydantic"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — Schema Validation com Pydantic</a>
                                <button class="unwatch-btn" data-lesson-id="3-3">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="3-4" data-video-url="https://youtu.be/dCJge6mKAR0" data-video-title="Aula 4 — Dependency Injection (Injeção de Dependência)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 4 — Dependency Injection (Injeção de Dependência)</a>
                                <button class="unwatch-btn" data-lesson-id="3-4">Desmarcar</button>
                            </div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="3-A1" data-activity-title="Desafio — Criar 3 Rotas CRUD básicas" data-activity-desc="Esta é uma atividade teórica/manual. Crie um arquivo Python com as rotas POST, GET e DELETE para um recurso 'Item' usando FastAPI e Pydantic. Não requer envio de código aqui."><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Criar 3 Rotas CRUD básicas</a>
                                <button class="unwatch-btn" data-lesson-id="3-A1">Desmarcar</button>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-3" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-3">0% concluído</div>
                        </div>
                    </div>
                    
                    <div class="course-card" data-module-id="4">
                        <h3>Módulo 4 — Bancos de Dados</h3>
                        <p>Conecte sua API com bancos de dados relacionais e não-relacionais.</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="4-1" data-video-url="https://www.youtube.com/watch?v=cHLKtALWDos" data-video-title="Aula 1 — SQLite e Introdução ao SQL"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — SQLite e Introdução ao SQL</a>
                                <button class="unwatch-btn" data-lesson-id="4-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="4-2" data-video-url="https://youtu.be/RNDFq9Q_N_Q" data-video-title="Aula 2 — Conexão com PostgreSQL"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Conexão com PostgreSQL</a>
                                <button class="unwatch-btn" data-lesson-id="4-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="4-3" data-video-url="https://youtu.be/y1Q_J4t_89c" data-video-title="Aula 3 — NoSQL com MongoDB"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — NoSQL com MongoDB</a>
                                <button class="unwatch-btn" data-lesson-id="4-3">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="4-4" data-video-url="https://youtu.be/9P-c_L0fK7s" data-video-title="Aula 4 — Gerenciando Sessions com FastAPI"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 4 — Gerenciando Sessions com FastAPI</a>
                                <button class="unwatch-btn" data-lesson-id="4-4">Desmarcar</button>
                            </div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="4-A1" data-activity-title="Desafio — Montar Querys SQL" data-activity-desc="Esta é uma atividade de texto. Escreva as queries SQL para (1) selecionar todos os usuários do Brasil e (2) atualizar o email do usuário com id=5."><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Montar Querys SQL</a>
                                <button class="unwatch-btn" data-lesson-id="4-A1">Desmarcar</button>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-4" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-4">0% concluído</div>
                        </div>
                    </div>
                </div>
                
                <div class="course-grid page" data-page="2">

                    <div class="course-card" data-module-id="5">
                        <h3>Módulo 5 — ORMs e Migrações</h3>
                        <p>Domine o uso de ORMs (Mapeadores Objeto-Relacional) para maior produtividade.</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="5-1" data-video-url="https://youtu.be/wG_X_8Q8eI8" data-video-title="Aula 1 — Introdução ao SQLAlchemy"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução ao SQLAlchemy</a>
                                <button class="unwatch-btn" data-lesson-id="5-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="5-2" data-video-url="https://youtu.be/F4d5fP-l1I4" data-video-title="Aula 2 — Definindo Models e Relationships"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Definindo Models e Relationships</a>
                                <button class="unwatch-btn" data-lesson-id="5-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="5-3" data-video-url="https://youtu.be/t2r1TjU_y0w" data-video-title="Aula 3 — Gerenciamento de Migrações com Alembic"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — Gerenciamento de Migrações com Alembic</a>
                                <button class="unwatch-btn" data-lesson-id="5-3">Desmarcar</button>
                            </div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="5-A1" data-activity-title="Desafio — Criar 2 Models Relacionais" data-activity-desc="Esta é uma atividade de texto. Implemente duas classes Pydantic, 'User' e 'Post', onde 'User' tem uma relação de 1-para-muitos com 'Post'."><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Criar 2 Models Relacionais</a>
                                <button class="unwatch-btn" data-lesson-id="5-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-5" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-5">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="6">
                        <h3>Módulo 6 — Segurança e Autenticação</h3>
                        <p>Implemente tokens, OAuth2 e permissões seguras em suas APIs.</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="6-1" data-video-url="https://youtu.be/auth1" data-video-title="Aula 1 — Autenticação via Token"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Autenticação via Token</a>
                                <button class="unwatch-btn" data-lesson-id="6-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="6-2" data-video-url="https://youtu.be/auth2" data-video-title="Aula 2 — Hashing de Senhas (Bcrypt)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Hashing de Senhas (Bcrypt)</a>
                                <button class="unwatch-btn" data-lesson-id="6-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="6-3" data-video-url="https://youtu.be/auth3" data-video-title="Aula 3 — OAuth2 e JWT"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — OAuth2 e JWT</a>
                                <button class="unwatch-btn" data-lesson-id="6-3">Desmarcar</button>
                            </div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="6-A1" data-activity-title="Desafio — Validação de Credenciais" data-activity-desc="Implemente uma função de validação de usuário e senha que use 'check_password_hash'. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Validação de Credenciais</a>
                                <button class="unwatch-btn" data-lesson-id="6-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-6" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-6">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="7">
                        <h3>Módulo 7 — Testes Unitários</h3>
                        <p>Garanta a estabilidade do seu código com testes unitários e de integração (Pytest).</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="7-1" data-video-url="https://youtu.be/test1" data-video-title="Aula 1 — Introdução ao Pytest"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução ao Pytest</a>
                                <button class="unwatch-btn" data-lesson-id="7-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="7-2" data-video-url="https://youtu.be/test2" data-video-title="Aula 2 — Testando Rotas de API"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Testando Rotas de API</a>
                                <button class="unwatch-btn" data-lesson-id="7-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="7-3" data-video-url="https://youtu.be/test3" data-video-title="Aula 3 — Mocking e Fixtures"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — Mocking e Fixtures</a>
                                <button class="unwatch-btn" data-lesson-id="7-3">Desmarcar</button>
                            </div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="7-A1" data-activity-title="Desafio — Escrever 3 Testes Básicos" data-activity-desc="Escreva 3 testes Pytest para uma função 'soma(a, b)'. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Escrever 3 Testes Básicos</a>
                                <button class="unwatch-btn" data-lesson-id="7-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-7" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-7">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="8">
                        <h3>Módulo 8 — Servidores Assíncronos</h3>
                        <p>Explore o universo assíncrono do Python com `asyncio` e `await`.</p>

                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="8-1" data-video-url="https://youtu.be/async1" data-video-title="Aula 1 — Conceitos de Assincronicidade"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Conceitos de Assincronicidade</a>
                                <button class="unwatch-btn" data-lesson-id="8-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="8-2" data-video-url="https://youtu.be/async2" data-video-title="Aula 2 — O uso de async/await"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — O uso de async/await</a>
                                <button class="unwatch-btn" data-lesson-id="8-2">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="8-3" data-video-url="https://youtu.be/async3" data-video-title="Aula 3 — Async/Await no FastAPI"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 3 — Async/Await no FastAPI</a>
                                <button class="unwatch-btn" data-lesson-id="8-3">Desmarcar</button>
                            </div>
                        </div>

                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="8-A1" data-activity-title="Desafio — Refatorar Função Síncrona" data-activity-desc="Refatore uma função síncrona simples para ser assíncrona. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Refatorar Função Síncrona</a>
                                <button class="unwatch-btn" data-lesson-id="8-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-8" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-8">0% concluído</div>
                        </div>
                    </div>
                </div>

                <div class="course-grid page" data-page="3">
                    <div class="course-card" data-module-id="9">
                        <h3>Módulo 9 — Deploy e Docker</h3>
                        <p>Aprenda a empacotar e implantar sua aplicação em contêineres Docker.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="9-1" data-video-url="https://youtu.be/docker1" data-video-title="Aula 1 — Introdução ao Dockerfile"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução ao Dockerfile</a>
                                <button class="unwatch-btn" data-lesson-id="9-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="9-2" data-video-url="https://youtu.be/docker2" data-video-title="Aula 2 — Docker Compose para Serviços"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Docker Compose para Serviços</a>
                                <button class="unwatch-btn" data-lesson-id="9-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="9-A1" data-activity-title="Desafio — Criar Dockerfile Básico" data-activity-desc="Crie um Dockerfile que instale Python e rode sua API. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Criar Dockerfile Básico</a>
                                <button class="unwatch-btn" data-lesson-id="9-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-9" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-9">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="10">
                        <h3>Módulo 10 — Mensageria (RabbitMQ/Celery)</h3>
                        <p>Use filas e processamento assíncrono de tarefas com Celery.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="10-1" data-video-url="https://youtu.be/celery1" data-video-title="Aula 1 — Introdução ao Celery e RabbitMQ"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução ao Celery e RabbitMQ</a>
                                <button class="unwatch-btn" data-lesson-id="10-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="10-2" data-video-url="https://youtu.be/celery2" data-video-title="Aula 2 — Criação de Tarefas Assíncronas"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Criação de Tarefas Assíncronas</a>
                                <button class="unwatch-btn" data-lesson-id="10-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="10-A1" data-activity-title="Desafio — Definir uma Tarefa Simples" data-activity-desc="Escreva o código Python para definir uma tarefa Celery simples de soma. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Definir uma Tarefa Simples</a>
                                <button class="unwatch-btn" data-lesson-id="10-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-10" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-10">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="11">
                        <h3>Módulo 11 — Redis para Caching</h3>
                        <p>Acelere sua API usando Redis como cache e banco de dados rápido.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="11-1" data-video-url="https://youtu.be/redis1" data-video-title="Aula 1 — Configuração e Conceitos do Redis"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Configuração e Conceitos do Redis</a>
                                <button class="unwatch-btn" data-lesson-id="11-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="11-2" data-video-url="https://youtu.be/redis2" data-video-title="Aula 2 — Implementando Caching de Respostas"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Implementando Caching de Respostas</a>
                                <button class="unwatch-btn" data-lesson-id="11-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="11-A1" data-activity-title="Desafio — Usar Redis para Contagem" data-activity-desc="Proponha uma rota para contar o número de requisições por IP usando Redis. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Usar Redis para Contagem</a>
                                <button class="unwatch-btn" data-lesson-id="11-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-11" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-11">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="12">
                        <h3>Módulo 12 — WebSockets</h3>
                        <p>Adicione comunicação em tempo real usando WebSockets com o `websockets` ou `fastapi-websocket`.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="12-1" data-video-url="https://youtu.be/ws1" data-video-title="Aula 1 — Introdução e Handshake"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução e Handshake</a>
                                <button class="unwatch-btn" data-lesson-id="12-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="12-2" data-video-url="https://youtu.be/ws2" data-video-title="Aula 2 — Criação de um Chat Básico"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Criação de um Chat Básico</a>
                                <button class="unwatch-btn" data-lesson-id="12-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="12-A1" data-activity-title="Desafio — Rota de WebSocket" data-activity-desc="Escreva uma rota WebSocket básica em FastAPI. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Rota de WebSocket</a>
                                <button class="unwatch-btn" data-lesson-id="12-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-12" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-12">0% concluído</div>
                        </div>
                    </div>
                </div>

                <div class="course-grid page" data-page="4">
                    <div class="course-card" data-module-id="13">
                        <h3>Módulo 13 — Integração com APIs Externas</h3>
                        <p>Aprenda a consumir e interagir com serviços RESTful de terceiros de forma assíncrona.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="13-1" data-video-url="https://youtu.be/httpx1" data-video-title="Aula 1 — Introdução ao HTTPX (Async)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução ao HTTPX (Async)</a>
                                <button class="unwatch-btn" data-lesson-id="13-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="13-2" data-video-url="https://youtu.be/httpx2" data-video-title="Aula 2 — Tratamento de Erros e Timeouts"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Tratamento de Erros e Timeouts</a>
                                <button class="unwatch-btn" data-lesson-id="13-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="13-A1" data-activity-title="Desafio — Chamar API Pública" data-activity-desc="Escreva o código para consumir uma API pública de informações de moedas. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Chamar API Pública</a>
                                <button class="unwatch-btn" data-lesson-id="13-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-13" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-13">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="14">
                        <h3>Módulo 14 — Logging e Monitoramento</h3>
                        <p>Use bibliotecas de logging para rastrear erros e eventos na sua aplicação.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="14-1" data-video-url="https://youtu.be/logging1" data-video-title="Aula 1 — Configuração Básica de Logging"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Configuração Básica de Logging</a>
                                <button class="unwatch-btn" data-lesson-id="14-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="14-2" data-video-url="https://youtu.be/logging2" data-video-title="Aula 2 — Formatação e Handlers"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Formatação e Handlers</a>
                                <button class="unwatch-btn" data-lesson-id="14-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="14-A1" data-activity-title="Desafio — Adicionar Logging de Erro" data-activity-desc="Adicione um bloco try/except em uma função que registre um erro de nível 'ERROR'. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Adicionar Logging de Erro</a>
                                <button class="unwatch-btn" data-lesson-id="14-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-14" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-14">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="15">
                        <h3>Módulo 15 — Performance e Otimização</h3>
                        <p>Identifique gargalos e otimize o desempenho da sua aplicação Python.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="15-1" data-video-url="https://youtu.be/perf1" data-video-title="Aula 1 — Profiling (cProfile)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Profiling (cProfile)</a>
                                <button class="unwatch-btn" data-lesson-id="15-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="15-2" data-video-url="https://youtu.be/perf2" data-video-title="Aula 2 — List Comprehension vs Loops"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — List Comprehension vs Loops</a>
                                <button class="unwatch-btn" data-lesson-id="15-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="15-A1" data-activity-title="Desafio — Otimizar Bloco de Código" data-activity-desc="Refatore um bloco de código ineficiente usando compreensão de lista. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Otimizar Bloco de Código</a>
                                <button class="unwatch-btn" data-lesson-id="15-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-15" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-15">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="16">
                        <h3>Módulo 16 — Arquitetura Microservices</h3>
                        <p>Entenda como construir e manter aplicações distribuídas e escaláveis.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="16-1" data-video-url="https://youtu.be/micro1" data-video-title="Aula 1 — Conceitos de Microservices"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Conceitos de Microservices</a>
                                <button class="unwatch-btn" data-lesson-id="16-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="16-2" data-video-url="https://youtu.be/micro2" data-video-title="Aula 2 — Comunicação Síncrona vs Assíncrona"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Comunicação Síncrona vs Assíncrona</a>
                                <button class="unwatch-btn" data-lesson-id="16-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="16-A1" data-activity-title="Desafio — Desenho de Arquitetura" data-activity-desc="Desenhe um diagrama de arquitetura de microservices para um e-commerce. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Desenho de Arquitetura</a>
                                <button class="unwatch-btn" data-lesson-id="16-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-16" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-16">0% concluído</div>
                        </div>
                    </div>
                </div>
                
                <div class="course-grid page" data-page="5">
                    <div class="course-card" data-module-id="17">
                        <h3>Módulo 17 — DevOps e CI/CD</h3>
                        <p>Automatize o deploy e a integração contínua usando ferramentas modernas.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="17-1" data-video-url="https://youtu.be/cicd1" data-video-title="Aula 1 — Introdução ao GitHub Actions"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Introdução ao GitHub Actions</a>
                                <button class="unwatch-btn" data-lesson-id="17-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="17-2" data-video-url="https://youtu.be/cicd2" data-video-title="Aula 2 — Pipeline de Testes e Deploy"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Pipeline de Testes e Deploy</a>
                                <button class="unwatch-btn" data-lesson-id="17-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="17-A1" data-activity-title="Desafio — Pipeline Básico" data-activity-desc="Descreva as etapas de um pipeline de CI/CD para a sua API. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Pipeline Básico</a>
                                <button class="unwatch-btn" data-lesson-id="17-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-17" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-17">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="18">
                        <h3>Módulo 18 — Cloud Computing (AWS/GCP)</h3>
                        <p>Gerencie sua infraestrutura em nuvem, focando em serviços essenciais para APIs.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="18-1" data-video-url="https://youtu.be/cloud1" data-video-title="Aula 1 — Serviços de Nuvem (EC2, Lambda) [AWS]"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Serviços de Nuvem (EC2, Lambda)</a>
                                <button class="unwatch-btn" data-lesson-id="18-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="18-2" data-video-url="https://youtu.be/cloud2" data-video-title="Aula 2 — Banco de Dados Gerenciados (RDS) e Storage (S3)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Banco de Dados Gerenciados (RDS) e Storage (S3)</a>
                                <button class="unwatch-btn" data-lesson-id="18-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="18-A1" data-activity-title="Desafio — Escolha de Serviço" data-activity-desc="Para uma API de alta carga, qual serviço de computação em nuvem você escolheria (EC2 vs Lambda) e por quê? (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Escolha de Serviço</a>
                                <button class="unwatch-btn" data-lesson-id="18-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-18" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-18">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="19">
                        <h3>Módulo 19 — Revisão e Melhores Práticas</h3>
                        <p>Consolidação de conhecimento e padrões de projeto essenciais (Design Patterns).</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="19-1" data-video-url="https://youtu.be/clean1" data-video-title="Aula 1 — Código Limpo (Clean Code)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Código Limpo (Clean Code)</a>
                                <button class="unwatch-btn" data-lesson-id="19-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="19-2" data-video-url="https://youtu.be/clean2" data-video-title="Aula 2 — Padrões de Projeto (Factory, Singleton)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Padrões de Projeto (Factory, Singleton)</a>
                                <button class="unwatch-btn" data-lesson-id="19-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="19-A1" data-activity-title="Desafio — Reorganizar Projeto Existente" data-activity-desc="Descreva como você aplicaria o padrão Repository em um projeto com classes ORM. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Reorganizar Projeto Existente</a>
                                <button class="unwatch-btn" data-lesson-id="19-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-19" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-19">0% concluído</div>
                        </div>
                    </div>

                    <div class="course-card" data-module-id="20">
                        <h3>Módulo 20 — Projeto Final Integrador</h3>
                        <p>Construa um projeto completo, aplicando todos os conceitos aprendidos no curso.</p>
                        <div class="lesson-list">
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="20-1" data-video-url="https://youtu.be/final1" data-video-title="Aula 1 — Escopo e Planejamento do Projeto"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 1 — Escopo e Planejamento do Projeto</a>
                                <button class="unwatch-btn" data-lesson-id="20-1">Desmarcar</button>
                            </div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-video-modal" data-lesson-id="20-2" data-video-url="https://youtu.be/final2" data-video-title="Aula 2 — Revisão do Código e Deploy Final"><span class="lesson-icon"><i class="far fa-circle"></i></span> Aula 2 — Revisão do Código e Deploy Final</a>
                                <button class="unwatch-btn" data-lesson-id="20-2">Desmarcar</button>
                            </div>
                        </div>
                        <div class="activity-list">
                            <div class="activity-list-title"><i class="fas fa-clipboard-list"></i> Atividades</div>
                            <div class="lesson-item-wrapper">
                                <a href="#" class="open-modal-activity" data-lesson-id="20-A1" data-activity-title="Desafio — Apresentação do Projeto Final" data-activity-desc="Submeta o link para o repositório do seu projeto final e um vídeo de demonstração. (Atividade Teórica)"><span class="lesson-icon"><i class="far fa-circle"></i></span> Desafio — Apresentação do Projeto Final</a>
                                <button class="unwatch-btn" data-lesson-id="20-A1">Desmarcar</button>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="progress-bar-20" style="width: 0%;"></div>
                            </div>
                            <div class="progress-label" id="progress-label-20">0% concluído</div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="pagination">
                <button class="page-button" id="prev-page-btn" disabled>Anterior</button>
                <span class="page-indicator" id="page-indicator">Página 1 de 5</span>
                <button class="page-button" id="next-page-btn">Próxima</button>
            </div>
        </div>
        
        <div class="modal-overlay" id="activity-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="activity-modal-title">Título da Atividade</h3>
                    <button class="modal-close-btn" data-modal="activity-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="activity-modal-description">Descrição da atividade...</p>
                    
                    <div class="activity-input-area">
                        <h4 id="input-title">Seu Código Python:</h4>
                        <textarea id="activity-code-input" placeholder="Insira seu código Python/SQL aqui..."></textarea>
                    </div>
                    
                    <button id="check-activity-btn" class="complete-activity-btn" style="background: #3498db; color: #fff;">
                        <i class="fas fa-check-circle"></i> CORRIGIR ATIVIDADE
                    </button>

                    <button id="submit-for-correction-btn" class="complete-activity-btn" style="background:#f39c12; color:#111; margin-top:8px;">
                        <i class="fas fa-paper-plane"></i> Enviar para Correção (Manual)
                    </button>

                    <div class="activity-feedback-area" id="activity-feedback-output">
                        O feedback do seu código aparecerá aqui.
                    </div>
                    
                    <button id="complete-activity-btn" class="complete-activity-btn">
                        Marcar como Concluído (Se Correto)
                    </button>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="video-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="video-modal-title">Título do Vídeo</h3>
                    <button class="modal-close-btn" data-modal="video-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="video-player-container">
                        <iframe id="video-iframe" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                    </div>
                    <button id="complete-video-btn" class="complete-video-btn">
                        Marcar Aula como Concluída
                    </button>
                </div>
            </div>
        </div>


<script>
            // --- VARIÁVEIS GLOBAIS ---
            let currentPage = 1;
            const totalPages = 5; // <--- ATUALIZADO para refletir 20 módulos (5 páginas x 4 módulos)
            let currentLessonId = null;

            // Armazenamento local (Simulação de progresso do usuário)
            const storageKey = 'pythonCourseProgress';
            let progressData = JSON.parse(localStorage.getItem(storageKey)) || {};

            // --- FUNÇÕES DE LÓGICA DO CURSO (Mantidas/Adaptadas) ---

            /**
             * Salva o estado do progresso no Local Storage.
             */
            function saveProgress() {
                localStorage.setItem(storageKey, JSON.stringify(progressData));
                updateUI();
                updateGlobalProgress();
            }

            /**
             * Marca uma lição como concluída/assistida.
             * @param {string} lessonId - ID da lição (ex: '1-A1', '2-1').
             */
            function markAsCompleted(lessonId) {
                progressData[lessonId] = true;
                saveProgress();
                
                // Se for atividade, ajusta o botão do modal
                const checkButton = document.getElementById('check-activity-btn');
                const completeButton = document.getElementById('complete-activity-btn');
                if (checkButton && completeButton) {
                    // Apenas altera se o botão está visível no modal
                    if (checkButton.style.display !== 'none') {
                        checkButton.textContent = "✅ ATIVIDADE CORRIGIDA E CONCLUÍDA";
                        checkButton.disabled = true;
                        checkButton.style.background = '#00ff88';
                        checkButton.style.color = '#111';
                    }
                    
                    if (completeButton.style.display !== 'none') {
                        completeButton.textContent = "✅ CONCLUÍDO";
                        completeButton.classList.add('completed');
                        completeButton.disabled = true;
                    }
                }
            }

            /**
             * Desmarca uma lição como concluída/assistida.
             * @param {string} lessonId - ID da lição.
             */
            function unmarkAsCompleted(lessonId) {
                delete progressData[lessonId];
                saveProgress();
            }

            /**
             * Atualiza os ícones na UI (círculo vazio vs. checkmark) e botões de desmarcar.
             */
            function updateUI() {
                document.querySelectorAll('[data-lesson-id]').forEach(element => {
                    const lessonId = element.dataset.lessonId;
                    const lessonWrapper = element.closest('.lesson-item-wrapper');
                    if (!lessonWrapper) return; // Garante que estamos dentro de um wrapper

                    const link = lessonWrapper.querySelector('a');
                    const icon = link.querySelector('.lesson-icon i');
                    const unwatchBtn = lessonWrapper.querySelector('.unwatch-btn');
                    
                    if (progressData[lessonId]) {
                        link.classList.add('watched');
                        icon.className = 'fas fa-check-circle';
                        if (unwatchBtn) unwatchBtn.style.display = 'inline-block';
                    } else {
                        link.classList.remove('watched');
                        icon.className = 'far fa-circle';
                        if (unwatchBtn) unwatchBtn.style.display = 'none';
                    }
                });

                // Atualizar progresso do módulo e cor do card
                document.querySelectorAll('.course-card').forEach(card => {
                    const moduleId = card.dataset.moduleId;
                    updateModuleProgress(moduleId);
                });
            }

            /**
             * Calcula e atualiza o progresso de um módulo específico.
             */
            function updateModuleProgress(moduleId) {
                const card = document.querySelector(`.course-card[data-module-id="${moduleId}"]`);
                if (!card) return;

                const allItems = card.querySelectorAll('[data-lesson-id]');
                const totalItems = allItems.length;
                let completedItems = 0;

                allItems.forEach(item => {
                    const lessonId = item.dataset.lessonId;
                    if (progressData[lessonId]) {
                        completedItems++;
                    }
                });

                const percentage = totalItems === 0 ? 0 : Math.round((completedItems / totalItems) * 100);
                
                const progressBar = document.getElementById(`progress-bar-${moduleId}`);
                const progressLabel = document.getElementById(`progress-label-${moduleId}`);

                if (progressBar && progressLabel) {
                    progressBar.style.width = `${percentage}%`;
                    progressLabel.textContent = `${percentage}% concluído`;

                    if (percentage === 100) {
                        progressBar.classList.add('completed');
                        progressLabel.classList.add('completed');
                    } else {
                        progressBar.classList.remove('completed');
                        progressLabel.classList.remove('completed');
                    }
                }
            }
            
            /**
             * Atualiza o dashboard de progresso global.
             */
            function updateGlobalProgress() {
                const allItems = document.querySelectorAll('.course-card [data-lesson-id]');
                const totalItems = allItems.length;
                const completedItems = Object.keys(progressData).length;
                const globalPercentage = totalItems === 0 ? 0 : Math.round((completedItems / totalItems) * 100);

                // Contagem de Módulos (Simulação: um módulo é completo se o progresso for 100%)
                const totalModules = document.querySelectorAll('.course-card').length;
                let completedModules = 0;
                for (let i = 1; i <= totalModules; i++) {
                    const progressBar = document.getElementById(`progress-bar-${i}`);
                    if (progressBar && progressBar.style.width === '100%') {
                        completedModules++;
                    }
                }
                
                document.getElementById('global-watched-count').textContent = `${completedItems} / ${totalItems}`;
                document.getElementById('global-modules-count').textContent = `${completedModules}/${totalModules}`;
                document.getElementById('global-progress-percent').textContent = `${globalPercentage}%`;
            }

            // --- FUNÇÕES DE PAGINAÇÃO (Mantidas) ---

            function showPage(pageNumber) {
                document.querySelectorAll('.course-grid.page').forEach(page => {
                    page.classList.remove('active-page');
                });

                const activePage = document.querySelector(`.course-grid.page[data-page="${pageNumber}"]`);
                if (activePage) {
                    activePage.classList.add('active-page');
                }

                currentPage = pageNumber;
                updatePaginationControls();
            }

            function updatePaginationControls() {
                document.getElementById('page-indicator').textContent = `Página ${currentPage} de ${totalPages}`;
                document.getElementById('prev-page-btn').disabled = (currentPage === 1);
                document.getElementById('next-page-btn').disabled = (currentPage === totalPages);
            }
            
            // --- FUNÇÕES DO MODAL (Adaptadas para Correção) ---

            /**
             * Abre o modal de Atividade.
             */
            document.querySelectorAll('.open-modal-activity').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    currentLessonId = this.dataset.lessonId;
                    const title = this.dataset.activityTitle;
                    const desc = this.dataset.activityDesc;
                    
                    const modal = document.getElementById('activity-modal');
                    const titleEl = document.getElementById('activity-modal-title');
                    const descEl = document.getElementById('activity-modal-description');
                    const codeInput = document.getElementById('activity-code-input');
                    const completeButton = document.getElementById('complete-activity-btn');
                    const checkButton = document.getElementById('check-activity-btn');
                    const feedbackOutput = document.getElementById('activity-feedback-output');
                    const inputTitle = document.getElementById('input-title');

                    // 1. Limpa o feedback e campos
                    feedbackOutput.textContent = 'O feedback do seu código aparecerá aqui.';
                    feedbackOutput.classList.remove('feedback-success', 'feedback-failure');
                    
                    // 2. Preenche os dados
                    titleEl.textContent = title;
                    descEl.textContent = desc;
                    
                    // 3. Checa se o item está concluído
                    const isCompleted = progressData[currentLessonId];
                    
                    // 4. Configura o Input e Botões
                    const isCodeActivity = ['1-A1', '1-A2'].includes(currentLessonId);

                    if (isCodeActivity) {
                        codeInput.style.display = 'block';
                        checkButton.style.display = 'block';
                        completeButton.style.display = 'none'; 
                        inputTitle.textContent = 'Seu Código Python (Insira a função completa):';

                        if (isCompleted) {
                            checkButton.textContent = "✅ ATIVIDADE CORRIGIDA E CONCLUÍDA";
                            checkButton.disabled = true;
                            checkButton.style.background = '#00ff88';
                            checkButton.style.color = '#111';
                        } else {
                            checkButton.textContent = "<i class=\"fas fa-check-circle\"></i> CORRIGIR ATIVIDADE";
                            checkButton.disabled = false;
                            checkButton.style.background = '#3498db';
                            checkButton.style.color = '#fff';
                        }

                    } else {
                        // Atividades teóricas ou avançadas que não são testadas pelo JS
                        codeInput.style.display = 'none'; 
                        checkButton.style.display = 'none';
                        completeButton.style.display = 'block';
                        inputTitle.textContent = 'Observações:';
                        
                        if (isCompleted) {
                            completeButton.textContent = "✅ CONCLUÍDO";
                            completeButton.classList.add('completed');
                            completeButton.disabled = true;
                        } else {
                            completeButton.textContent = "Marcar como Concluído";
                            completeButton.classList.remove('completed');
                            completeButton.disabled = false;
                        }

                    }

                    modal.classList.add('open');
                });
            });
            
            /**
             * Abre o modal de Vídeo. (Mantida)
             */
            document.querySelectorAll('.open-video-modal').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    currentLessonId = this.dataset.lessonId;
                    const title = this.dataset.videoTitle;
                    let url = this.dataset.videoUrl;
                    
                    // Convert YouTube URL to embed format (if necessary)
                    if (url.includes('youtu.be') || url.includes('youtube.com/watch')) {
                        const videoId = url.split('/').pop().split('=').pop().split('&')[0];
                        url = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                    }

                    document.getElementById('video-modal-title').textContent = title;
                    document.getElementById('video-iframe').src = url;

                    const completeButton = document.getElementById('complete-video-btn');
                    if (progressData[currentLessonId]) {
                        completeButton.textContent = "✅ CONCLUÍDO";
                        completeButton.classList.add('completed');
                        completeButton.disabled = true;
                    } else {
                        completeButton.textContent = "Marcar Aula como Concluída";
                        completeButton.classList.remove('completed');
                        completeButton.disabled = false;
                    }

                    document.getElementById('video-modal').classList.add('open');
                });
            });
            
            /**
             * Fecha qualquer modal. (Adaptada)
             */
            document.querySelectorAll('.modal-close-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modalId = this.dataset.modal;
                    const modal = document.getElementById(modalId);
                    modal.classList.remove('open');
                    
                    // Parar vídeo se for o modal de vídeo
                    if (modalId === 'video-modal') {
                        document.getElementById('video-iframe').src = '';
                    }
                    
                    // Limpar campos de input da atividade
                    if (modalId === 'activity-modal') {
                        document.getElementById('activity-code-input').value = '';
                        document.getElementById('activity-feedback-output').textContent = 'O feedback do seu código aparecerá aqui.';
                        document.getElementById('activity-feedback-output').classList.remove('feedback-success', 'feedback-failure');
                    }
                    currentLessonId = null;
                });
            });
            
            // --- EVENT LISTENERS GERAIS (Mantidos) ---

            // Pular página
            document.getElementById('prev-page-btn').addEventListener('click', () => {
                if (currentPage > 1) {
                    showPage(currentPage - 1);
                }
            });

            document.getElementById('next-page-btn').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    showPage(currentPage + 1);
                }
            });

            document.querySelectorAll('.unwatch-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation(); 
                    const lessonId = this.dataset.lessonId;
                    unmarkAsCompleted(lessonId);
                });
            });

            document.getElementById('complete-video-btn').addEventListener('click', function() {
                if (currentLessonId && !this.classList.contains('completed')) {
                    markAsCompleted(currentLessonId);
                    document.querySelector('.modal-close-btn[data-modal="video-modal"]').click();
                }
            });

            document.getElementById('complete-activity-btn').addEventListener('click', function() {
                // Este botão só é exibido para atividades não-código (3-A1, 4-A1, etc.)
                if (currentLessonId && !this.classList.contains('completed')) {
                    markAsCompleted(currentLessonId);
                    document.querySelector('.modal-close-btn[data-modal="activity-modal"]').click();
                }
            });

            const activityTests = {
                '1-A1': {
                    funcName: 'calcular_imc',
                    testCases: [
                        { inputs: [70, 1.75], expected: 22.86, precision: 2 }, 
                        { inputs: [90, 1.80], expected: 27.78, precision: 2 },
                        { inputs: [55, 1.60], expected: 21.48, precision: 2 }
                    ]
                },
                '1-A2': {
                    funcName: 'inverter_string',
                    testCases: [
                        { inputs: ['Python'], expected: 'nohtyP' },
                        { inputs: ['hello'], expected: 'olleh' },
                        { inputs: ['',], expected: '' },
                        { inputs: ['12345'], expected: '54321' }
                    ]
                }
            };


            function correctActivityJS(activityId, userCode) {
                if (!userCode.trim()) {
                    return { feedback: "Por favor, insira seu código Python para correção. Certifique-se de incluir a definição completa da função.", passed: false };
                }

                const testConfig = activityTests[activityId];
                if (!testConfig) {
                    return { feedback: `ID de Atividade '${activityId}' não suportado ou não exige correção automática.`, passed: false };
                }

                const funcName = testConfig.funcName;
                let feedback = [];
                let allPassed = true;

                try {
                    eval(userCode); 

                    if (typeof window[funcName] !== 'function') {
                        return { feedback: `❌ Erro: A função '${funcName}' não foi definida ou não está acessível globalmente.`, passed: false };
                    }

                } catch (e) {
                    return { feedback: `❌ Erro de Sintaxe/Execução no seu código: ${e.name}: ${e.message}`, passed: false };
                }

                const userFunc = window[funcName];

                testConfig.testCases.forEach((test, index) => {
                    let userResult;
                    let passed = false;
                    const inputsString = test.inputs.map(input => typeof input === 'string' ? `'${input}'` : input).join(', ');

                    try {
                        userResult = userFunc(...test.inputs);

                        if (test.precision) {
                            const userRounded = parseFloat(userResult).toFixed(test.precision);
                            const expectedRounded = test.expected.toFixed(test.precision);

                            if (userRounded === expectedRounded) {
                                passed = true;
                                feedback.push(`✅ Teste ${index + 1} (${inputsString}): Passou! Seu resultado: ${userResult} (Arredondado: ${userRounded})`);
                            } else {
                                feedback.push(`❌ Teste ${index + 1} (${inputsString}): Falhou. Esperado: ${expectedRounded}, Recebido: ${userRounded}.`);
                            }
                        } else {
                            if (userResult === test.expected) {
                                passed = true;
                                feedback.push(`✅ Teste ${index + 1} (${inputsString}): Passou! Seu resultado: '${userResult}'`);
                            } else {
                                feedback.push(`❌ Teste ${index + 1} (${inputsString}): Falhou. Esperado: '${test.expected}', Recebido: '${userResult}'.`);
                            }
                        }

                    } catch (e) {
                        feedback.push(`❌ Teste ${index + 1} (${inputsString}): Erro durante a chamada da função. Erro: ${e.message}.`);
                    }

                    if (!passed) {
                        allPassed = false;
                    }
                });

                if (allPassed) {
                    return { 
                        feedback: feedback.join('\n') + "\n\n**PARABÉNS! Seu código passou em todos os testes.**", 
                        passed: true 
                    };
                } else {
                    return { 
                        feedback: feedback.join('\n') + "\n\n**CORREÇÃO NECESSÁRIA:** Pelo menos um teste falhou. Revise a lógica da sua função.", 
                        passed: false 
                    };
                }
            }
            
            
            document.getElementById('check-activity-btn').addEventListener('click', function() {
                const userCode = document.getElementById('activity-code-input').value;
                const activityId = currentLessonId;
                const feedbackOutput = document.getElementById('activity-feedback-output');
                
                feedbackOutput.classList.remove('feedback-success', 'feedback-failure');

                const result = correctActivityJS(activityId, userCode);
                
                feedbackOutput.textContent = result.feedback;

                if (result.passed) {
                    feedbackOutput.classList.add('feedback-success');
                    markAsCompleted(activityId); 
                    
                } else {
                    feedbackOutput.classList.add('feedback-failure');
                    
                    this.textContent = "<i class=\"fas fa-exclamation-triangle\"></i> TENTE NOVAMENTE";
                }
            });

            // Enviar para correção manual (POST para backend com fallback local)
            document.getElementById('submit-for-correction-btn').addEventListener('click', async function() {
                const activityId = currentLessonId;
                const code = document.getElementById('activity-code-input').value || '';
                const feedbackOutput = document.getElementById('activity-feedback-output');
                feedbackOutput.classList.remove('feedback-success','feedback-failure');

                if (!activityId) return;
                if (!code.trim()) {
                    feedbackOutput.classList.add('feedback-failure');
                    feedbackOutput.textContent = 'Por favor, insira seu código antes de enviar para correção.';
                    return;
                }

                const btn = this;
                btn.disabled = true;
                const originalText = btn.textContent;
                btn.textContent = 'Enviando...';

                try {
                    const res = await fetch('/submit-activity', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ lessonId: activityId, code })
                    });

                    if (res.ok) {
                        feedbackOutput.classList.add('feedback-success');
                        feedbackOutput.textContent = 'Enviado para correção — status: PENDENTE. Você será notificado quando for corrigido.';
                        // save pending locally as fallback
                        const pending = JSON.parse(localStorage.getItem('pendingCorrections') || '{}');
                        pending[activityId] = { code, status: 'pending', ts: Date.now() };
                        localStorage.setItem('pendingCorrections', JSON.stringify(pending));
                        // mark UI as pending
                        const anchor = document.querySelector(`a[data-lesson-id="${activityId}"]`);
                        if (anchor) {
                            anchor.classList.remove('wrong');
                            anchor.classList.add('pending');
                            const icon = anchor.querySelector('.lesson-icon i');
                            if (icon) icon.className = 'fas fa-hourglass-half';
                        }
                    } else {
                        const text = await res.text().catch(() => res.statusText || 'Erro');
                        feedbackOutput.classList.add('feedback-failure');
                        feedbackOutput.textContent = 'Falha ao enviar: ' + text;
                    }
                } catch (err) {
                    // fallback: save locally as pending
                    feedbackOutput.classList.add('feedback-failure');
                    feedbackOutput.textContent = 'Erro de rede ao enviar. Salvando localmente como pendente.';
                    const pending = JSON.parse(localStorage.getItem('pendingCorrections') || '{}');
                    pending[activityId] = { code, status: 'pending', ts: Date.now() };
                    localStorage.setItem('pendingCorrections', JSON.stringify(pending));
                    const anchor = document.querySelector(`a[data-lesson-id="${activityId}"]`);
                    if (anchor) {
                        anchor.classList.remove('wrong');
                        anchor.classList.add('pending');
                        const icon = anchor.querySelector('.lesson-icon i');
                        if (icon) icon.className = 'fas fa-hourglass-half';
                    }
                } finally {
                    btn.disabled = false;
                    btn.textContent = originalText;
                }
            });

            document.addEventListener('DOMContentLoaded', () => {
                updateUI();
                updateGlobalProgress();
                showPage(currentPage);  
        
            });

// Armazenamento de progresso simulado
        let progress = JSON.parse(localStorage.getItem('courseProgress')) || {};
        let currentActId = null;
        let totalItems = 0;
        let totalModules = 20;

        // FUNÇÕES GERAIS
        function changePage(num) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.querySelector(`.page[data-page="${num}"]`).classList.add('active-page');
            document.querySelectorAll('.page-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.page-btn:nth-child(${num})`).classList.add('active');
        }

        function updateProgress() {
            totalItems = 0;
            let completedItems = 0;
            let completedModules = 0;

            document.querySelectorAll('.course-card').forEach(moduleCard => {
                const moduleId = moduleCard.dataset.moduleId;
                const itemsInModule = moduleCard.querySelectorAll('.lesson-item-wrapper').length;
                let completedItemsInModule = 0;

                moduleCard.querySelectorAll('.lesson-item-wrapper').forEach(item => {
                    const lessonId = item.dataset.lessonId;
                    totalItems++;

                    if (progress[lessonId]) {
                        item.classList.add('completed');
                        item.querySelector('.lesson-icon').innerHTML = '<i class="fas fa-circle-check"></i>';
                        completedItems++;
                        completedItemsInModule++;
                    } else {
                        item.classList.remove('completed');
                        item.querySelector('.lesson-icon').innerHTML = '<i class="far fa-circle"></i>';
                    }
                });

                const moduleProgressPercent = itemsInModule > 0 ? (completedItemsInModule / itemsInModule) * 100 : 0;
                
                const progressBar = document.getElementById(`progress-bar-${moduleId}`);
                const progressLabel = document.getElementById(`progress-label-${moduleId}`);

                if (progressBar) progressBar.style.width = `${moduleProgressPercent.toFixed(0)}%`;
                if (progressLabel) progressLabel.innerText = `${moduleProgressPercent.toFixed(0)}% concluído`;

                if (moduleProgressPercent === 100) {
                    completedModules++;
                }
            });

            const globalProgressPercent = totalItems > 0 ? (completedItems / totalItems) * 100 : 0;

            document.getElementById('global-watched-count').innerText = `${completedItems}/${totalItems}`;
            document.getElementById('global-modules-count').innerText = `${completedModules}/${totalModules}`;
            document.getElementById('global-progress-percent').innerText = `${globalProgressPercent.toFixed(1)}%`;

            localStorage.setItem('courseProgress', JSON.stringify(progress));
        }

        // EVENTOS DE MARCAÇÃO
        document.querySelectorAll('.open-video-modal').forEach(link => {
            link.onclick = function(e) {
                e.preventDefault();
                currentActId = this.parentElement.dataset.lessonId;
                document.getElementById('modal-video-title').innerText = this.dataset.videoTitle;
                document.getElementById('video-modal').style.display = 'block';

                // Marcar como concluído ao fechar o modal ou usar o botão
                document.getElementById('mark-watched-btn').onclick = () => {
                    progress[currentActId] = true;
                    updateProgress();
                    document.getElementById('video-modal').style.display = 'none';
                };
            };
        });

        document.querySelectorAll('.unwatch-btn').forEach(btn => {
            btn.onclick = function(e) {
                e.stopPropagation(); // Evita que o clique abra o modal
                const lessonId = this.dataset.lessonId;
                delete progress[lessonId];
                updateProgress();
            };
        });

        // ABRIR MODAL DE ATIVIDADE
        document.querySelectorAll('.open-modal-activity').forEach(link => {
            link.onclick = function(e) {
                e.preventDefault();
                currentActId = this.parentElement.dataset.lessonId;
                document.getElementById('modal-activity-title').innerText = this.dataset.activityTitle;
                document.getElementById('modal-activity-desc').innerText = this.dataset.activityDesc;
                document.getElementById('correction-result').style.display = 'none';
                document.getElementById('correction-result').className = "result-message";
                document.getElementById('student-code').value = '';
                document.getElementById('submit-activity-btn').disabled = false;
                document.getElementById('submit-activity-btn').innerText = "Corrigir Atividade";
                document.getElementById('activity-modal').style.display = 'block';
            };
        });

        // FECHAR MODAIS
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.onclick = () => {
                document.getElementById('activity-modal').style.display = 'none';
                document.getElementById('video-modal').style.display = 'none';
            };
        });

        // FUNÇÃO DE CORREÇÃO (O core do desafio)
        function runCorrection() {
            const code = document.getElementById('student-code').value;
            const resultBox = document.getElementById('correction-result');
            const btn = document.getElementById('submit-activity-btn');
            
            if (code.trim().length < 10) {
                resultBox.className = "result-message result-error";
                resultBox.innerHTML = "❌ <b>Código muito curto!</b> Insira pelo menos 10 caracteres.";
                resultBox.style.display = 'block';
                return;
            }

            btn.disabled = true;
            btn.innerText = "Processando no Servidor...";
            resultBox.style.display = 'none';

            // Simulação de verificação backend
            setTimeout(() => {
                let success = false;
                const normalizedCode = code.toLowerCase();

                // Lógica de validação baseada no lessonId (para simular correção específica)
                if (currentActId === '1-A1' && normalizedCode.includes('def calcular_imc(')) success = true;
                else if (currentActId === '2-A1' && normalizedCode.includes('class contabancaria')) success = true;
                else if (currentActId === '3-A1' && normalizedCode.includes('@app.post') && normalizedCode.includes('@app.get')) success = true;
                else if (currentActId === '4-A1' && normalizedCode.includes('select') && normalizedCode.includes('update')) success = true;
                else if (currentActId === '9-A1' && normalizedCode.includes('from python:') && normalizedCode.includes('copy')) success = true;
                else if (currentActId === '10-A1' && normalizedCode.includes('beautifulsoup')) success = true;
                else if (currentActId === '20-A1' && normalizedCode.includes('https://github.com/')) success = true;
                else if (normalizedCode.includes('def') || normalizedCode.includes('import') || normalizedCode.includes('class')) success = true;
                else success = Math.random() < 0.8; // Chance de sucesso para desafios não específicos

                btn.disabled = false;
                btn.innerText = "Corrigir Atividade";
                resultBox.style.display = 'block';

                if (success) {
                    resultBox.className = "result-message result-success";
                    resultBox.innerHTML = "✅ <b>Código Aprovado!</b> Parabéns, sua solução foi validada. (Progresso Registrado)";
                    progress[currentActId] = true;
                    updateProgress();
                } else {
                    resultBox.className = "result-message result-error";
                    resultBox.innerHTML = "❌ <b>Ops!</b> Seu código não atende aos requisitos ou contém erros de lógica simulados.";
                }
            }, 1500);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', updateProgress);
    
document.addEventListener('DOMContentLoaded', () => {

    // --- Helpers para persistência ---
    const getWatchedState = () => {
        try { return JSON.parse(localStorage.getItem('courseWatchedState') || '{}'); } catch { return {}; }
    };
    const setWatchedState = (s) => localStorage.setItem('courseWatchedState', JSON.stringify(s));

    const getActivitiesState = () => {
        try { return JSON.parse(localStorage.getItem('courseActivitiesState') || '{}'); } catch { return {}; }
    };
    const setActivitiesState = (s) => localStorage.setItem('courseActivitiesState', JSON.stringify(s));

    let watchedState = getWatchedState();
    let activitiesState = getActivitiesState();
    let currentLessonId = null;

    // --- Utilitários de UI ---
    const isActivityId = id => /-A/i.test(id);

    const updateItemUI = (lessonId) => {
        const anchor = document.querySelector(`a[data-lesson-id="${lessonId}"]`);
        if (!anchor) return;
        const icon = anchor.querySelector('.lesson-icon i');
        anchor.classList.remove('watched','wrong','pending');
        if (isActivityId(lessonId)) {
            const st = activitiesState[lessonId];
            if (st && st.status === 'correct') {
                anchor.classList.add('watched');
                if (icon) icon.className = 'fas fa-check-circle';
            } else if (st && st.status === 'wrong') {
                anchor.classList.add('wrong');
                if (icon) icon.className = 'fas fa-times-circle';
            } else if (st && st.status === 'pending') {
                anchor.classList.add('pending');
                if (icon) icon.className = 'fas fa-hourglass-half';
            } else {
                if (icon) icon.className = 'far fa-circle';
            }
        } else {
            if (watchedState[lessonId]) {
                anchor.classList.add('watched');
                if (icon) icon.className = 'fas fa-check-circle';
            } else {
                if (icon) icon.className = 'far fa-circle';
            }
        }

        // show/hide corresponding unwatch button
        const unwatchBtn = document.querySelector(`button.unwatch-btn[data-lesson-id="${lessonId}"]`);
        if (unwatchBtn) {
            if (isActivityId(lessonId)) {
                unwatchBtn.style.display = (activitiesState[lessonId] && activitiesState[lessonId].status === 'correct') ? 'inline-block' : 'none';
            } else {
                unwatchBtn.style.display = watchedState[lessonId] ? 'inline-block' : 'none';
            }
        }
    };

    const updateAllUI = () => {
        document.querySelectorAll('a[data-lesson-id]').forEach(a => updateItemUI(a.dataset.lessonId));
        updateGlobalProgress();
    };

    const updateGlobalProgress = () => {
        const anchors = Array.from(document.querySelectorAll('a[data-lesson-id]'));
        const total = anchors.length;
        let done = 0;
        const modules = new Set();
        anchors.forEach(a => {
            const id = a.dataset.lessonId;
            modules.add(id.split('-')[0]);
            if (isActivityId(id)) {
                if (activitiesState[id] && activitiesState[id].status === 'correct') done++;
            } else {
                if (watchedState[id]) done++;
            }
        });
        const totalModules = modules.size || 1;
        const completedModules = Array.from(document.querySelectorAll('.course-card')).reduce((acc, card) => {
            const links = Array.from(card.querySelectorAll('a[data-lesson-id]'));
            const allDone = links.every(l => {
                const id = l.dataset.lessonId;
                return isActivityId(id) ? (activitiesState[id] && activitiesState[id].status === 'correct') : !!watchedState[id];
            });
            return acc + (allDone ? 1 : 0);
        }, 0);

        const percent = total > 0 ? Math.round((done / total) * 100) : 0;
        const watchedCountEl = document.getElementById('global-watched-count');
        const modulesCountEl = document.getElementById('global-modules-count');
        const progressPercentEl = document.getElementById('global-progress-percent');
        if (watchedCountEl) watchedCountEl.textContent = `${done}`;
        if (modulesCountEl) modulesCountEl.textContent = `${completedModules}/${totalModules}`;
        if (progressPercentEl) progressPercentEl.textContent = `${percent}%`;

        // update per-module progress bars
        document.querySelectorAll('.course-card').forEach(card => {
            const moduleId = card.dataset.moduleId;
            const links = Array.from(card.querySelectorAll('a[data-lesson-id]'));
            const totalItems = links.length;
            let doneItems = 0;
            links.forEach(l => {
                const id = l.dataset.lessonId;
                if (isActivityId(id)) {
                    if (activitiesState[id] && activitiesState[id].status === 'correct') doneItems++;
                } else {
                    if (watchedState[id]) doneItems++;
                }
            });
            const pct = totalItems ? Math.round((doneItems / totalItems) * 100) : 0;
            const bar = document.getElementById(`progress-bar-${moduleId}`);
            const label = document.getElementById(`progress-label-${moduleId}`);
            if (bar) { bar.style.width = `${pct}%`; bar.classList.toggle('completed', pct === 100); }
            if (label) { label.textContent = `${pct}% concluído`; label.classList.toggle('completed', pct === 100); }
        });
    };

    // --- Validações heurísticas para atividades ---
    const validators = {
        '1-A1': (answer) => {
            const code = answer.toLowerCase();
            if (!/calcular_imc\s*\(/.test(code)) return { ok: false, message: "Defina função calcular_imc(peso, altura)." };
            if (!(/\*\*2/.test(code) || /altura\s*\*\s*altura/.test(code))) return { ok: false, message: "Use 'altura**2' ou 'altura * altura' no cálculo." };
            return { ok: true };
        },
        '1-A2': (answer) => {
            const code = answer.toLowerCase();
            if (!/inverter_string\s*\(/.test(code)) return { ok: false, message: "Defina função inverter_string(texto)." };
            if (/\[:\-1\]/.test(code) || /reversed\(/.test(code)) return { ok: true };
            return { ok: false, message: "Use slicing [::-1] ou reversed para inverter string." };
        },
        '2-A2': (answer) => {
            const code = answer.toLowerCase();
            if (!/contar_palavras\s*\(/.test(code)) return { ok: false, message: "Defina contar_palavras(texto)." };
            if (/\.split\(/.test(code) || /collections\.counter/.test(code)) return { ok: true };
            return { ok: false, message: "Use split() ou collections.Counter para contar palavras." };
        },
        '4-A1': (answer) => {
            const up = answer.toUpperCase();
            const hasSelect = /SELECT\b/.test(up);
            const hasUpdate = /UPDATE\b/.test(up);
            const missing = [];
            if (!hasSelect) missing.push('SELECT');
            if (!hasUpdate) missing.push('UPDATE');
            if (missing.length) return { ok: false, message: 'Falta: ' + missing.join(', ') };
            return { ok: true };
        },
        '6-A1': (answer) => {
            const code = answer.toLowerCase();
            if (!/def\s+(?:soma|somar)\s*\(/.test(code) && !/def\s+soma\s*\(/.test(code)) return { ok: false, message: "Crie função soma(a,b)." };
            return { ok: true };
        }
    };

    // --- Modais / Inputs ---
    const activityModal = document.getElementById('activity-modal');
    const activityTitleEl = document.getElementById('activity-modal-title');
    const activityDescEl = document.getElementById('activity-modal-description');
    const codeInput = document.getElementById('activity-code-input');
    const checkBtn = document.getElementById('check-activity-btn');
    const feedbackEl = document.getElementById('activity-feedback-output');
    const completeBtn = document.getElementById('complete-activity-btn');

    const videoModal = document.getElementById('video-modal');
    const videoTitleEl = document.getElementById('video-modal-title');
    const videoIframe = document.getElementById('video-iframe');
    const completeVideoBtn = document.getElementById('complete-video-btn');

    const openActivityModal = (title, desc, lessonId) => {
        currentLessonId = lessonId;
        activityTitleEl.textContent = title || 'Atividade';
        activityDescEl.textContent = desc || '';
        const st = activitiesState[lessonId];
        codeInput.value = st && st.answer ? st.answer : '';
        feedbackEl.className = 'activity-feedback-area';
        feedbackEl.textContent = st ? (st.status === 'correct' ? 'Atividade já corrigida: correta.' : (st.status === 'wrong' ? 'Envio anterior incorreto.' : 'Resposta pendente de correção.')) : 'O feedback do seu código aparecerá aqui.';
        activityModal.classList.add('open');
        if (st && st.status === 'correct') {
            completeBtn.classList.add('completed');
            completeBtn.textContent = 'Concluído';
        } else {
            completeBtn.classList.remove('completed');
            completeBtn.textContent = 'Marcar como Concluído (Se Correto)';
        }
    };

    const closeActivityModal = () => {
        activityModal.classList.remove('open');
        currentLessonId = null;
    };

    // fechar modais
    document.querySelectorAll('.modal-close-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const modalId = btn.dataset.modal;
            if (modalId === 'video-modal') {
                videoIframe.src = '';
                videoModal.classList.remove('open');
                currentLessonId = null;
            } else if (modalId === 'activity-modal') {
                closeActivityModal();
            } else {
                const el = document.getElementById(modalId);
                if (el) el.classList.remove('open');
            }
        });
    });

    // --- Delegação de cliques: abrir modais e desmarcar ---
    document.querySelector('.course-grid-wrapper').addEventListener('click', (e) => {
        const videoAnchor = e.target.closest('a.open-video-modal');
        if (videoAnchor) {
            e.preventDefault();

            // bloqueio por pagamento — trata cancelamento corretamente e impede outros handlers
            const lockedFlag = String(videoAnchor.dataset.locked || '').trim();
            const isLocked = (lockedFlag === '1' || lockedFlag === 'true');

            if (isLocked) {
                const go = confirm('Esta aula está bloqueada. Deseja ir para a página de pagamentos (R$29,99)?');
                if (go) {
                    window.location.href = '/pagamento';
                    return;
                }
                // usuário cancelou: garantir que nenhum handler anterior/seguinte abra a aula
                try { e.stopImmediatePropagation?.(); } catch (err) {}
                try { e.stopPropagation?.(); } catch (err) {}
                // fechar modal caso já tenha sido aberto por outro listener
                if (videoIframe) videoIframe.src = '';
                if (videoModal) videoModal.classList.remove('open');
                return;
            }

            const url = videoAnchor.dataset.videoUrl || '';
            const title = videoAnchor.dataset.videoTitle || '';
            const lessonId = videoAnchor.dataset.lessonId;
            currentLessonId = lessonId;
            // convert youtube formats
            let embed = url;
            try {
                if (url.includes('youtu.be/')) {
                    const id = url.split('youtu.be/')[1].split('?')[0];
                    embed = `https://www.youtube.com/embed/${id}`;
                } else if (url.includes('youtube.com/watch')) {
                    const v = new URL(url).searchParams.get('v');
                    if (v) embed = `https://www.youtube.com/embed/${v}`;
                } else if (url.includes('youtube.com/embed/')) {
                    embed = url;
                }
            } catch (err) { embed = url; }

            videoTitleEl.textContent = title;
            videoIframe.src = embed + '?autoplay=1&rel=0';
            videoModal.classList.add('open');
            if (watchedState[lessonId]) {
                completeVideoBtn.classList.add('completed');
                completeVideoBtn.textContent = 'Concluído';
            } else {
                completeVideoBtn.classList.remove('completed');
                completeVideoBtn.textContent = 'Marcar Aula como Concluída';
            }
            return;
        }


        const activityAnchor = e.target.closest('a.open-modal-activity');
        if (activityAnchor) {
            e.preventDefault();
            openActivityModal(activityAnchor.dataset.activityTitle, activityAnchor.dataset.activityDesc, activityAnchor.dataset.lessonId);
            return;
        }

        const unwatchBtn = e.target.closest('button.unwatch-btn');
        if (unwatchBtn) {
            const lessonId = unwatchBtn.dataset.lessonId;
            if (!lessonId) return;
            if (isActivityId(lessonId)) {
                delete activitiesState[lessonId];
                setActivitiesState(activitiesState);
            } else {
                delete watchedState[lessonId];
                setWatchedState(watchedState);
            }
            updateItemUI(lessonId);
            updateGlobalProgress();
            return;
        }
    });

    // botão "Corrigir Atividade"
    if (checkBtn) {
        checkBtn.addEventListener('click', () => {
            if (!currentLessonId) return;
            const answer = codeInput.value.trim();
            if (!answer) {
                feedbackEl.classList.add('feedback-failure');
                feedbackEl.textContent = 'Escreva algo antes de enviar para correção.';
                return;
            }
            const validator = validators[currentLessonId];
            if (validator) {
                const res = validator(answer);
                if (res.ok) {
                    activitiesState[currentLessonId] = { status: 'correct', answer };
                    setActivitiesState(activitiesState);
                    feedbackEl.classList.remove('feedback-failure');
                    feedbackEl.classList.add('feedback-success');
                    feedbackEl.textContent = 'Resposta correta — atividade marcada como correta.';
                    completeBtn.classList.add('completed');
                    completeBtn.textContent = 'Concluído';
                } else {
                    activitiesState[currentLessonId] = { status: 'wrong', answer };
                    setActivitiesState(activitiesState);
                    feedbackEl.classList.remove('feedback-success');
                    feedbackEl.classList.add('feedback-failure');
                    feedbackEl.textContent = `Resposta incorreta — ${res.message || 'Revise e tente novamente.'}`;
                    completeBtn.classList.remove('completed');
                    completeBtn.textContent = 'Reenviar para Correção';
                }
            } else {
                activitiesState[currentLessonId] = { status: 'pending', answer };
                setActivitiesState(activitiesState);
                feedbackEl.classList.remove('feedback-failure','feedback-success');
                feedbackEl.textContent = 'Resposta salva — pendente de correção manual.';
                completeBtn.classList.remove('completed');
                completeBtn.textContent = 'Enviar (Pendente)';
            }
            updateItemUI(currentLessonId);
            updateGlobalProgress();
        });
    }

    // marcar atividade como concluída (só se validação ok)
    if (completeBtn) {
        completeBtn.addEventListener('click', () => {
            if (!currentLessonId) return;
            const st = activitiesState[currentLessonId];
            if (st && st.status === 'correct') {
                updateItemUI(currentLessonId);
                updateGlobalProgress();
                setTimeout(closeActivityModal, 400);
                return;
            }
            feedbackEl.classList.add('feedback-failure');
            feedbackEl.textContent = 'A atividade não está correta. Use "CORRIGIR ATIVIDADE" antes de marcar como concluída.';
        });
    }
    
    // marcar vídeo como concluído
    if (completeVideoBtn) {
        completeVideoBtn.addEventListener('click', () => {
            if (!currentLessonId) return;
            if (!watchedState[currentLessonId]) {
                watchedState[currentLessonId] = true;
                setWatchedState(watchedState);
                updateItemUI(currentLessonId);
                updateGlobalProgress();
                completeVideoBtn.classList.add('completed');
                completeVideoBtn.textContent = 'Concluído';
                setTimeout(() => {
                    videoIframe.src = '';
                    videoModal.classList.remove('open');
                    currentLessonId = null;
                }, 500);
            }
        });
    }

    // --- PAGINAÇÃO ---
    const pages = Array.from(document.querySelectorAll('.course-grid.page'));
    const totalPages = pages.length || 1;
    let currentPage = 1;
    const prevBtn = document.getElementById('prev-page-btn');
    const nextBtn = document.getElementById('next-page-btn');
    const pageIndicator = document.getElementById('page-indicator');

    const showPage = (n) => {
        if (n < 1) n = 1;
        if (n > totalPages) n = totalPages;
        pages.forEach(p => p.classList.toggle('active-page', parseInt(p.dataset.page, 10) === n));
        currentPage = n;
        if (pageIndicator) pageIndicator.textContent = `Página ${currentPage} de ${totalPages}`;
        if (prevBtn) prevBtn.disabled = currentPage === 1;
        if (nextBtn) nextBtn.disabled = currentPage === totalPages;
        const topEl = document.querySelector('.container');
        if (topEl) topEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
    };

    if (prevBtn) prevBtn.addEventListener('click', () => showPage(currentPage - 1));
    if (nextBtn) nextBtn.addEventListener('click', () => showPage(currentPage + 1));
    showPage(1);

    // inicializa UI
    updateAllUI();

    // pequeno hook para botões sociais / dev login (se existirem)
    const g = document.getElementById('googleLogin');
    if (g) g.addEventListener('click', () => window.location.href = "/auth/google");
    const f = document.getElementById('facebookLogin');
    if (f) f.addEventListener('click', () => window.location.href = "/auth/facebook");
    const form = document.querySelector("form");
    if (form) {
        form.addEventListener("submit", function (e) {
            const usernameInput = form.querySelector("input[name='username']");
            const passwordInput = form.querySelector("input[name='password']");
            if (usernameInput && passwordInput) {
                const username = usernameInput.value;
                const password = passwordInput.value;
                if (username === "dev" && password === "dev") {
                    e.preventDefault();
                    window.location.href = "/login_dev";
                }
            }
        });
    }
});


document.addEventListener('DOMContentLoaded', () => {

    // --- Helpers para persistência ---
    const getWatchedState = () => {
        try { return JSON.parse(localStorage.getItem('courseWatchedState') || '{}'); } catch { return {}; }
    };
    const setWatchedState = (s) => localStorage.setItem('courseWatchedState', JSON.stringify(s));

    const getActivitiesState = () => {
        try { return JSON.parse(localStorage.getItem('courseActivitiesState') || '{}'); } catch { return {}; }
    };
    const setActivitiesState = (s) => localStorage.setItem('courseActivitiesState', JSON.stringify(s));

   const isCoursePaid = () => localStorage.getItem('course_paid') === '1';
    const markCoursePaid = () => { localStorage.setItem('course_paid','1'); window.dispatchEvent(new Event('course-paid')); };

    let watchedState = getWatchedState();
    let activitiesState = getActivitiesState();
    let currentLessonId = null;

    // ensure first lesson always unlocked
    const firstLessonId = '1-1';

    // --- Utilitários de UI ---
    const isActivityId = id => /-A/i.test(id);

    const updateItemUI = (lessonId) => {
        const anchor = document.querySelector(`a[data-lesson-id="${lessonId}"]`);
        if (!anchor) return;
        const icon = anchor.querySelector('.lesson-icon i');
        anchor.classList.remove('watched','wrong','pending');
        // lock handling
        const paid = isCoursePaid();
        const locked = (!paid && lessonId !== firstLessonId);
        // ensure lock icon exists
        let lockEl = anchor.querySelector('.lock-icon');
       if (!lockEl) {
           lockEl = document.createElement('span');
           lockEl.className = 'lock-icon';            anchor.appendChild(lockEl);
        }      lockEl.classList.toggle('locked', locked);
       lockEl.classList.toggle('unlocked', !locked);
        lockEl.title = locked ? 'Aula bloqueada. Pague R$29,99 para liberar.' : 'Aula liberada';
       lockEl.innerHTML = locked ? '<i class=\"fas fa-lock\"></i>' : '<i class=\"fas fa-unlock\"></i>';
        // visual pointer
        anchor.dataset.locked = locked ? '1' : '0';
        // update action button (toggle Marcar / Desmarcar)
        const unwatchBtn = document.querySelector(`button.unwatch-btn[data-lesson-id="${lessonId}"]`);
        if (unwatchBtn) {
            if (locked) {
                unwatchBtn.style.display = 'none';
            } else {
                if (isActivityId(lessonId)) {
                    const st = activitiesState[lessonId];
                    if (st && st.status === 'correct') {
                        unwatchBtn.style.display = 'inline-block';
                        unwatchBtn.textContent = 'Desmarcar';
                        unwatchBtn.setAttribute('aria-pressed','true');
                    } else {
                        unwatchBtn.style.display = 'inline-block';
                        unwatchBtn.textContent = 'Marcar';
                        unwatchBtn.setAttribute('aria-pressed','false');
                    }
                } else {
                    if (watchedState[lessonId]) {
                        unwatchBtn.style.display = 'inline-block';
                        unwatchBtn.textContent = 'Desmarcar';
                        unwatchBtn.setAttribute('aria-pressed','true');
                    } else {
                        unwatchBtn.style.display = 'inline-block';
                        unwatchBtn.textContent = 'Marcar';
                        unwatchBtn.setAttribute('aria-pressed','false');
                    }
                }
            }
        }

        if (isActivityId(lessonId)) {
            const st = activitiesState[lessonId];
            if (st && st.status === 'correct') {
                anchor.classList.add('watched');
                if (icon) icon.className = 'fas fa-check-circle';
            } else if (st && st.status === 'wrong') {
                anchor.classList.add('wrong');
                if (icon) icon.className = 'fas fa-times-circle';
            } else if (st && st.status === 'pending') {
                anchor.classList.add('pending');
                if (icon) icon.className = 'fas fa-hourglass-half';
            } else {
                if (icon) icon.className = 'far fa-circle';
            }
        } else {
            if (watchedState[lessonId]) {
                anchor.classList.add('watched');
                if (icon) icon.className = 'fas fa-check-circle';
            } else {
                if (icon) icon.className = 'far fa-circle';
            }
        }
    };
    // listen for payment event (from payment page)
    window.addEventListener('course-paid', () => {
        // paid -> refresh UI
        updateAllUI();
        // gentle toast instead of blocking alert
        try {
            const toast = document.createElement('div');
            toast.textContent = 'Pagamento confirmado — todas as aulas liberadas.';
            toast.style.position = 'fixed';
            toast.style.right = '20px';
            toast.style.bottom = '20px';
            toast.style.background = '#0b5';
            toast.style.color = '#001';
            toast.style.padding = '10px 14px';
            toast.style.borderRadius = '8px';
            toast.style.boxShadow = '0 6px 18px rgba(0,0,0,0.5)';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3500);
        } catch (e) { alert('Pagamento confirmado — todas as aulas liberadas.'); }
    });
    // also listen storage event (in case payment happens in new tab)
    window.addEventListener('storage', (ev) => {
       if (ev.key === 'course_paid' && ev.newValue === '1') {
            window.dispatchEvent(new Event('course-paid'));
        }
  });

    const updateAllUI = () => {
        document.querySelectorAll('a[data-lesson-id]').forEach(a => updateItemUI(a.dataset.lessonId));
        updateGlobalProgress();
    };

    // ...existing code...

    // --- Delegação de cliques: abrir modais e desmarcar ---
    document.querySelector('.course-grid-wrapper').addEventListener('click', (e) => {
        const videoAnchor = e.target.closest('a.open-video-modal');
        if (videoAnchor) {
            e.preventDefault();
        // bloqueio por pagamento
           if (videoAnchor.dataset.locked === '1') {
               if (confirm('Esta aula está bloqueada. Deseja ir para a página de pagamentos (R$29,99)?')) {
                  window.location.href = '/pagamento';
               }
             return;
           }
            const url = videoAnchor.dataset.videoUrl || '';
            const title = videoAnchor.dataset.videoTitle || '';
            const lessonId = videoAnchor.dataset.lessonId;
            currentLessonId = lessonId;
            // convert youtube formats
            let embed = url;
            try {
                if (url.includes('youtu.be/')) {
                    const id = url.split('youtu.be/')[1].split('?')[0];
                    embed = `https://www.youtube.com/embed/${id}`;
                } else if (url.includes('youtube.com/watch')) {
                    const v = new URL(url).searchParams.get('v');
                    if (v) embed = `https://www.youtube.com/embed/${v}`;
                } else if (url.includes('youtube.com/embed/')) {
                    embed = url;
                }
            } catch (err) { embed = url; }

            videoTitleEl.textContent = title;
            videoIframe.src = embed + '?autoplay=1&rel=0';
            videoModal.classList.add('open');
            if (watchedState[lessonId]) {
                completeVideoBtn.classList.add('completed');
                completeVideoBtn.textContent = 'Concluído';
            } else {
                completeVideoBtn.classList.remove('completed');
                completeVideoBtn.textContent = 'Marcar Aula como Concluída';
            }
            return;
        }

        const activityAnchor = e.target.closest('a.open-modal-activity');
        if (activityAnchor) {
            e.preventDefault();
           if (activityAnchor.dataset.locked === '1') {
              if (confirm('Esta atividade está bloqueada. Deseja ir para a página de pagamentos (R$29,99)?')) {
                 window.location.href = '/pagamento';
             }
               return;
           }
            openActivityModal(activityAnchor.dataset.activityTitle, activityAnchor.dataset.activityDesc, activityAnchor.dataset.lessonId);
            return;
        }

        const unwatchBtn = e.target.closest('button.unwatch-btn');
        if (unwatchBtn) {
            const lessonId = unwatchBtn.dataset.lessonId;
            if (!lessonId) return;
            if (isActivityId(lessonId)) {
                const st = activitiesState[lessonId];
                if (st && st.status === 'correct') {
                    // unmark
                    delete activitiesState[lessonId];
                } else {
                    // quick-mark as correct (conclude activity)
                    activitiesState[lessonId] = { status: 'correct', answer: '' };
                }
                setActivitiesState(activitiesState);
            } else {
                if (watchedState[lessonId]) {
                    delete watchedState[lessonId];
                } else {
                    watchedState[lessonId] = true;
                }
                setWatchedState(watchedState);
            }
            updateItemUI(lessonId);
            updateGlobalProgress();
            return;
        }
    });

    

    // ...existing code...
    // inicializa UI
-   updateAllUI();
+   updateAllUI();
});

function formatDateTime(dtStr) {
    const dt = new Date(dtStr);
    if (isNaN(dt)) return dtStr;
    return dt.toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' });
}

</script>
    </body>
    </html>
<!--    <script src="{{ static_url ('js/curso.js')}}"></script>
-->
<script>
// Função que verifica se o curso foi concluído
function verificarConclusao() {
    const progressoTexto = document.getElementById('global-progress-percent').innerText;
    const progressoNum = parseInt(progressoTexto.replace('%', ''));

    // Se o progresso for 100%, dispara o certificado
    if (progressoNum === 100) {
        mostrarCertificado();
    }
}

function mostrarCertificado() {
    // Verifica se já existe um modal de certificado para não duplicar
    if (document.getElementById('modal-certificado')) return;

    // Cria o HTML do Certificado (baseado no seu modelo)
    const certificadoHTML = `
        <div id="modal-certificado" class="modal-overlay open" style="display: flex; opacity: 1;">
            <div class="modal-content" style="max-width: 850px; background: #000; padding: 10px;">
                <button onclick="document.getElementById('modal-certificado').remove()" style="position: absolute; right: 20px; top: 20px; background: none; border: none; color: gold; cursor: pointer; font-size: 20px; z-index: 9999;">✕ Fechar</button>
                
                <div style="width: 800px; height: 560px; padding: 40px; background: #050505; border: 15px solid #d4af37; color: white; font-family: 'Inter', sans-serif; text-align: center; position: relative; box-sizing: border-box; margin: 0 auto;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 300px; color: rgba(212, 175, 55, 0.03); font-weight: 900; pointer-events: none;">PRO</div>
                    <div style="border: 2px solid rgba(212, 175, 55, 0.3); height: 100%; padding: 40px; display: flex; flex-direction: column; justify-content: space-between;">
                        <div style="font-size: 24px; font-weight: 800; letter-spacing: 2px;">MILHAS<span style="color: #d4af37;">PRO</span></div>
                        <div>
                            <h1 style="font-size: 42px; margin: 0; text-transform: uppercase; letter-spacing: 5px; color: #f1d592;">Certificado</h1>
                            <p style="font-size: 16px; color: #aaa; margin-top: 10px;">DE CONCLUSÃO E ESPECIALIZAÇÃO</p>
                        </div>
                        <div>
                            <p style="font-size: 18px; color: #ccc; margin-bottom: 5px;">Certificamos que para os devidos fins que</p>
                            <h2 style="font-size: 32px; color: #fff; margin: 10px 0; border-bottom: 1px solid #d4af37; display: inline-block; padding: 0 50px;">ALUNO MILHAS PRO</h2>
                            <p style="font-size: 18px; color: #ccc; margin-top: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">
                                concluiu com êxito o treinamento <strong>MilhasPro - O Método Definitivo</strong>, dominando estratégias avançadas de acúmulo, multiplicação e emissões de luxo.
                            </p>
                        </div>
                        <div style="display: flex; justify-content: space-around; align-items: flex-end; margin-top: 30px;">
                            <div style="text-align: center;">
                                <div style="width: 150px; border-top: 1px solid #d4af37; margin-bottom: 5px;"></div>
                                <p style="font-size: 12px; color: #aaa;">DIRETOR MILHASPRO</p>
                            </div>
                            <div style="text-align: center;">
                                <img src="https://img.icons8.com/color/48/guarantee.png" width="60">
                                <p style="font-size: 10px; color: #d4af37; margin-top: 5px;">VALIDADO EM 2026</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 150px; border-top: 1px solid #d4af37; margin-bottom: 5px;"></div>
                                <p style="font-size: 12px; color: #aaa;">COORDENAÇÃO</p>
                            </div>
                        </div>
                    </div>
                </div>
                <button onclick="window.print()" style="margin-top: 20px; background: #d4af37; color: #000; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%;">Imprimir Certificado / Salvar PDF</button>
            </div>
        </div>
    `;

    document.body.insertAdjacentHTML('beforeend', certificadoHTML);
}

// Observador para verificar toda vez que o progresso mudar
const targetNode = document.getElementById('global-progress-percent');
const config = { characterData: true, childList: true, subtree: true };
const callback = function(mutationsList, observer) {
    verificarConclusao();
};
const observer = new MutationObserver(callback);
observer.observe(targetNode, config);

// Verifica ao carregar a página também
window.onload = verificarConclusao;


// Adicione esta função ao seu script
function mostrarNotificacao(mensagem) {
    const toast = document.createElement('div');
    toast.style = `
        position: fixed; bottom: 20px; right: 20px;
        background: #d4af37; color: #000; padding: 15px 25px;
        border-radius: 8px; font-weight: bold; z-index: 10000;
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        animation: slideIn 0.5s ease-out;
    `;
    toast.innerText = mensagem;
    document.body.appendChild(toast);
    
    setTimeout(() => { toast.remove(); }, 3000);
}

// Chame assim: mostrarNotificacao("✅ Aula marcada como concluída!");
</script>